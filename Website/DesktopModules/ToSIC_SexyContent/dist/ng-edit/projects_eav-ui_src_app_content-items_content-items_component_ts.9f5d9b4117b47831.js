"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_content-items_content-items_component_ts","projects_eav-ui_src_app_shared_directives_click-stop-propagation_directive_ts","projects_eav-ui_src_app_app-administration_services_app-dialog-config_service_ts-_86580","projects_eav-ui_src_app_app-administration_services_app-dialog-config_service_ts-_86581"],{9731:(A,v,a)=>{a.d(v,{K:()=>g});var l=a(1650),c=a(9736),p=a(3738),y=a(716),T=a(2611),u=a(9039),_=a(4860),D=a(6232),f=a(7648);let g=(()=>{class d{constructor(t,C,h,P,U){this.http=t,this.context=C,this.dnnContext=h,this.globalConfigService=P,this.dialogSettings$={},U.loadFromService(this)}getShared$(t){return t??=this.context.appId,this.dialogSettings$[t]||(this.dialogSettings$[t]=this.getDialogSettings(t).pipe((0,l.d)({refCount:!1}))),this.dialogSettings$[t]}getDialogSettings(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/dialog/settings"),{params:{appId:t??this.context.appId.toString()}}).pipe((0,c.U)(C=>(C.Context.Language.List=C.Context.Language.List.filter(h=>h.IsEnabled),C)),(0,p.b)(C=>{this.globalConfigService.allowDebug(C.Context.Enable.DebugMode)}))}static#t=this.\u0275fac=function(C){return new(C||d)(u.LFG(_.eN),u.LFG(T._),u.LFG(D._y),u.LFG(y.bE),u.LFG(f.k))};static#e=this.\u0275prov=u.Yz7({token:d,factory:d.\u0275fac})}return d})()},2369:(A,v,a)=>{a.d(v,{T:()=>u});var l=a(2611),c=a(3379),p=a(9039),y=a(4860),T=a(6232);let u=(()=>{class _{constructor(f,m,g){this.http=f,this.context=m,this.dnnContext=g}getContentInfo(f){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(c.v+"Get"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),scope:f}})}exportParts(f,m,g){const d=this.dnnContext.$2sxc.http.apiUrl(c.v+"Export")+"?appId="+this.context.appId.toString()+"&zoneId="+this.context.zoneId.toString()+"&contentTypeIdsString="+f.join(";")+"&entityIdsString="+m.join(";")+"&templateIdsString="+g.join(";");window.open(d,"_blank","")}static#t=this.\u0275fac=function(m){return new(m||_)(p.LFG(y.eN),p.LFG(l._),p.LFG(T._y))};static#e=this.\u0275prov=p.Yz7({token:_,factory:_.\u0275fac})}return _})()},2091:(A,v,a)=>{a.d(v,{v:()=>u});var l=a(4173),c=a(2611),p=a(9039),y=a(4860),T=a(6232);let u=(()=>{class _{constructor(f,m,g){this.http=f,this.context=m,this.dnnContext=g}getAppInfo(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(l.H+"Statistics"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}exportApp(f,m){const g=this.dnnContext.$2sxc.http.apiUrl(l.H+"Export")+"?appId="+this.context.appId+"&zoneId="+this.context.zoneId+"&includeContentGroups="+f+"&resetAppGuid="+m;window.open(g,"_blank","")}exportForVersionControl({includeContentGroups:f,resetAppGuid:m,withFiles:g}){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(l.H+"SaveData"),{params:{appid:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),includeContentGroups:f.toString(),resetAppGuid:m.toString(),withPortalFiles:g.toString()}})}static#t=this.\u0275fac=function(m){return new(m||_)(p.LFG(y.eN),p.LFG(c._),p.LFG(T._y))};static#e=this.\u0275prov=p.Yz7({token:_,factory:_.\u0275fac})}return _})()},3379:(A,v,a)=>{a.d(v,{v:()=>u,z:()=>_});var l=a(4173),c=a(2611),p=a(9039),y=a(4860),T=a(6232);const u="admin/appParts/";let _=(()=>{class D{constructor(m,g,d){this.http=m,this.context=g,this.dnnContext=d}importAppParts(m){const g=new FormData;return g.append("File",m),this.http.post(this.dnnContext.$2sxc.http.apiUrl(u+"Import"),g,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}resetApp(m){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(l.H+"Reset"),{},{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString(),withPortalFiles:m.toString()}})}static#t=this.\u0275fac=function(g){return new(g||D)(p.LFG(y.eN),p.LFG(c._),p.LFG(T._y))};static#e=this.\u0275prov=p.Yz7({token:D,factory:D.\u0275fac})}return D})()},1217:(A,v,a)=>{a.d(v,{Az:()=>u.Az,Kw:()=>l.K,TB:()=>u.TB,bf:()=>u.bf,cv:()=>u.cv,h3:()=>_.h,nt:()=>u.nt,sF:()=>c.s,vG:()=>u.vG});var l=a(9731),c=a(5530),u=(a(2369),a(2091),a(3379),a(7749)),_=a(6992)},7749:(A,v,a)=>{a.d(v,{Az:()=>t,TB:()=>h,bf:()=>P,cv:()=>I,nt:()=>C,vG:()=>U});var l=a(6253),c=a(1891),p=a(9736),y=a(8953),T=a(237),u=a(2611),_=a(9039),D=a(4860),f=a(6232);const I="admin/query/Run",t="admin/query/DebugStream",C="admin/query/Save",h="admin/query/Get",P="admin/query/DataSources";let U=(()=>{class Z{constructor(b,M,G){this.http=b,this.context=M,this.dnnContext=G}getAll(b){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(y.PS),{params:{appId:this.context.appId.toString(),contentType:b}})}importQuery(b){return(0,l.D)((0,T.s)(b)).pipe((0,c.w)(M=>this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/query/import"),{AppId:this.context.appId.toString(),ContentBase64:M})),(0,p.U)(M=>({Success:M,Messages:[]})))}clonePipeline(b){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/query/Clone"),{params:{Id:b.toString(),appId:this.context.appId.toString()}})}delete(b){return this.http.delete(this.dnnContext.$2sxc.http.apiUrl("admin/query/Delete"),{params:{appId:this.context.appId.toString(),Id:b.toString()}})}static#t=this.\u0275fac=function(M){return new(M||Z)(_.LFG(D.eN),_.LFG(u._),_.LFG(f._y))};static#e=this.\u0275prov=_.Yz7({token:Z,factory:Z.\u0275fac})}return Z})()},6992:(A,v,a)=>{a.d(v,{h:()=>g});var l=a(2611),c=a(9039),p=a(4860),y=a(6232);const T="admin/view/",u=T+"all",_=T+"delete",D=T+"import",f=T+"polymorphism",m=T+"usage";let g=(()=>{class d{constructor(t,C,h){this.http=t,this.context=C,this.dnnContext=h}getAll(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(u),{params:{appId:this.context.appId.toString()}})}delete(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(_),{params:{appId:this.context.appId.toString(),Id:t.toString()}})}import(t){const C=new FormData;return C.append("File",t),this.http.post(this.dnnContext.$2sxc.http.apiUrl(D),C,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})}export(t){const C=this.dnnContext.$2sxc.http.apiUrl(T+"json")+"?appId="+this.context.appId+"&viewId="+t;window.open(C,"_blank","")}getPolymorphism(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(f),{params:{appId:this.context.appId.toString()}})}getUsage(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(m),{params:{appId:this.context.appId.toString(),guid:t}})}static#t=this.\u0275fac=function(C){return new(C||d)(c.LFG(p.eN),c.LFG(l._),c.LFG(y._y))};static#e=this.\u0275prov=c.Yz7({token:d,factory:d.\u0275fac})}return d})()},1352:(A,v,a)=>{a.r(v),a.d(v,{ContentItemsComponent:()=>_e});var l=a(9877),c=a(8071),p=a(3839),y=a(9736),T=a(4520),u=a(1527),_=a(5530),D=a(4323),f=a(6191),m=a(716),g=a(3955),d=a(6041),I=a(8730),t=a(9039),C=a(1268),h=a(8849),P=a(9674);const U=["valueInput"];let Z=(()=>{class o{constructor(){this.filter="",this.idFilterString="",this.idFilter=[]}agInit(e){this.filterParams=e}isFilterActive(){return""!==this.filter||this.idFilter.length>0}doesFilterPass(e){if(""!==this.filter){const i=this.filterParams.valueGetter({api:this.filterParams.api,colDef:this.filterParams.colDef,column:this.filterParams.column,columnApi:this.filterParams.columnApi,context:this.filterParams.context,data:e.node.data,getValue:s=>e.node.data[s],node:e.node});if(null==i||!i.some(s=>!!s&&s.includes(this.filter)))return!1}if(this.idFilter.length>0){const n=e.data[this.filterParams.colDef.headerName];if(null==n||!this.idFilter.some(i=>n.some(s=>s.Id===i)))return!1}return!0}getModel(){return this.isFilterActive()?{filterType:"entity",filter:this.filter,idFilter:this.idFilter}:void 0}setModel(e){this.filter=e?.filter??"",this.idFilter=e?.idFilter??[],this.idFilterString=e?.idFilter?.join(",")??""}afterGuiAttached(e){this.valueInputRef.nativeElement.focus()}updateIdFilter(){this.idFilter=this.idFilterString.split(",").map(e=>parseInt(e,10)).filter(e=>!isNaN(e))}filterChanged(){this.filterParams.filterChangedCallback()}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-entity-filter"]],viewQuery:function(n,i){if(1&n&&t.Gf(U,5),2&n){let s;t.iGM(s=t.CRH())&&(i.valueInputRef=s.first)}},decls:9,vars:2,consts:[["color","accent",1,"eav-form-field"],["matInput","","type","text",3,"ngModel","ngModelChange"],["valueInput",""]],template:function(n,i){1&n&&(t.TgZ(0,"mat-form-field",0)(1,"mat-label"),t._uU(2,"Value"),t.qZA(),t.TgZ(3,"input",1,2),t.NdJ("ngModelChange",function(E){return i.filter=E})("ngModelChange",function(){return i.filterChanged()}),t.qZA()(),t.TgZ(5,"mat-form-field",0)(6,"mat-label"),t._uU(7,"IDs (comma separated)"),t.qZA(),t.TgZ(8,"input",1),t.NdJ("ngModelChange",function(E){return i.idFilterString=E})("ngModelChange",function(){return i.updateIdFilter(),i.filterChanged()}),t.qZA()()),2&n&&(t.xp6(3),t.Q6J("ngModel",i.filter),t.xp6(5),t.Q6J("ngModel",i.idFilterString))},dependencies:[C.KE,C.hX,h.Fj,h.JJ,h.On,P.Nt],styles:["[_nghost-%COMP%]{display:block;padding:16px 12px 2px}.mat-mdc-form-field[_ngcontent-%COMP%]{display:block;width:175px}"]})}return o})();var q=a(5253),b=a(6433),M=a(196),G=a(6115),tt=a(1766),W=a(2957),F=a(9498),B=a(6515),H=a(257),k=a(8128);function et(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteItem())}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA(),t.TgZ(3,"span"),t._uU(4,"Delete"),t.qZA()()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.item._EditInfo.DisableDelete)}}let nt=(()=>{class o{agInit(e){this.params=e,this.item=e.data}refresh(e){return!0}clone(){this.params.onClone(this.item)}export(){this.params.onExport(this.item)}deleteItem(){this.params.onDelete(this.item)}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-content-items-actions"]],decls:13,vars:1,consts:[[1,"actions-component"],["matRipple","","tippy","Copy",1,"eav-grid-action-button","highlight",3,"click"],["matRipple","","tippy","Export",1,"eav-grid-action-button","highlight",3,"click"],["matRipple","","tippy","More",1,"eav-grid-action-button","highlight",3,"matMenuTriggerFor"],[1,"grid-more-menu"],["menu","matMenu"],["matMenuContent",""],["mat-menu-item","",3,"disabled","click"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1),t.NdJ("click",function(){return i.clone()}),t.TgZ(2,"mat-icon"),t._uU(3,"file_copy"),t.qZA()(),t.TgZ(4,"div",2),t.NdJ("click",function(){return i.export()}),t.TgZ(5,"mat-icon"),t._uU(6,"cloud_download"),t.qZA()(),t.TgZ(7,"div",3)(8,"mat-icon"),t._uU(9,"more_horiz"),t.qZA()()(),t.TgZ(10,"mat-menu",4,5),t.YNc(12,et,5,1,"ng-template",6),t.qZA()),2&n){const s=t.MAs(11);t.xp6(7),t.Q6J("matMenuTriggerFor",s)}},dependencies:[F.$,B.Hw,H.wG,k.VK,k.OP,k.KA,k.p6]})}return o})();function ot(o,r){if(1&o&&(t.TgZ(0,"span",2),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(e.entities)}}let it=(()=>{class o{agInit(e){Array.isArray(e.value)&&(this.encodedValue=this.htmlEncode(e.value.join(", ")),e.colDef.allowMultiValue&&(this.entities=e.value.length))}refresh(e){return!0}htmlEncode(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-content-items-entity"]],decls:3,vars:3,consts:[[3,"tippy"],["class","more-entities"],[1,"more-entities"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t.YNc(1,ot,2,1,"span",1),t._uU(2),t.qZA()),2&n&&(t.Q6J("tippy",i.encodedValue),t.xp6(1),t.um2(1,i.entities?1:-1),t.xp6(1),t.hij(" ",i.encodedValue,"\n"))},dependencies:[F.$],styles:[".more-entities[_ngcontent-%COMP%]{padding:0 8px;border-radius:10px;border:1px solid rgba(29,39,61,.44);-webkit-user-select:none;user-select:none}"]})}return o})();var S=a(6575),at=a(5392);const st=o=>({"hide-until-row-hover":o});function rt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",4),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openMetadata())}),t.TgZ(1,"mat-icon",5),t._uU(2),t.qZA()()}if(2&o){const e=t.oxw();t.Q6J("ngClass",t.VKq(5,st,!e.metadataCount&&!e.value.metadata))("tippy",e.metadataTooltip),t.xp6(1),t.Q6J("matBadge",e.metadataCount)("matBadgeHidden",!e.metadataCount),t.xp6(1),t.hij("",e.value.metadata?"loyalty":"local_offer"," ")}}function lt(o,r){if(1&o&&(t.TgZ(0,"div",6)(1,"mat-icon",7),t._uU(2),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("matBadge",e.metadataCount)("matBadgeHidden",!e.metadataCount),t.xp6(1),t.hij("",e.value.metadata?"loyalty":"local_offer"," ")}}let dt=(()=>{class o{agInit(e){this.value=e.value,this.params=e,this.item=e.data,this.disableMetadata=this.item._EditInfo.DisableMetadata,this.metadataCount=this.item.Metadata?.length??0,this.metadataTooltip=this.item.For?`This item is metadata for:\nTarget: ${this.item.For.Target}\nTargetType: ${this.item.For.TargetType}`+(this.item.For.Number?`\nNumber: ${this.item.For.Number}`:"")+(this.item.For.String?`\nString: ${this.item.For.String}`:"")+(this.item.For.Guid?`\nGuid: ${this.item.For.Guid}`:"")+(this.item.For.Title?`\nTitle: ${this.item.For.Title}`:""):"This item is not metadata.",this.metadataTooltip+=`\n\nThis item has ${this.metadataCount>0?this.metadataCount:"no"} other metadata ${1===this.metadataCount?"item":"items"} attached to it.`}refresh(e){return!0}openMetadata(){this.params.onOpenMetadata(this.item)}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-content-items-status"]],decls:6,vars:4,consts:[[1,"actions-component"],[1,"eav-grid-action-button","icon",3,"tippy"],["class","eav-grid-action-button highlight","matRipple","",3,"ngClass","tippy"],["class","eav-grid-action-button disabled"],["matRipple","",1,"eav-grid-action-button","highlight",3,"ngClass","tippy","click"],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"],[1,"eav-grid-action-button","disabled"],["matBadgeColor","accent","matBadgeSize","small","matBadgeDisabled","true","matBadgePosition","below after","aria-hidden","false",3,"matBadge","matBadgeHidden"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"mat-icon"),t._uU(3),t.qZA()(),t.YNc(4,rt,3,7,"div",2)(5,lt,3,3,"div",3),t.qZA()),2&n&&(t.xp6(1),t.Q6J("tippy",i.value.published?"Published":"Not published"),t.xp6(2),t.Oqu(i.value.published?"visibility":"visibility_off"),t.xp6(1),t.um2(4,i.disableMetadata?-1:4),t.xp6(1),t.um2(5,i.disableMetadata&&(i.metadataCount||i.value.metadata)?5:-1))},dependencies:[S.mk,F.$,B.Hw,H.wG,at.k],styles:[".hide-until-row-hover[_ngcontent-%COMP%]{visibility:hidden}  .ag-row-hover .hide-until-row-hover{visibility:visible}"]})}return o})();var R=a(926),Q=a(5043),K=a(3317),pt=a(7835),ut=a(1217),mt=a(9097),Y=a(8834),_t=a(2611),V=a(7100),ht=a(3188);function gt(o){return r=>{if(!r.value)return null;const e=o.controls.keyType.value,n=r.value.toString();switch(e){case M.Zy.keyTypes.number:return/^[0-9]+$/.test(n)?null:{patternWholeNumber:!0};case M.Zy.keyTypes.guid:const s=["{","}"].some(O=>n.includes(O)),E=n.substring(s?1:0,s?n.length-1:n.length);return(0,ht.M)().test(E)?null:{patternGuid:!0};default:return null}}}var $=a(6861),ft=a(9851),Ct=a(131),N=a(895),Tt=a(6355),yt=a(9293);function vt(o,r){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.targetType),t.xp6(1),t.hij(" ",e.label," ")}}function xt(o,r){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=t.oxw(2);t.Q6J("value",e.formValues.targetType),t.xp6(1),t.hij(" ",e.formValues.targetType," ")}}function Mt(o,r){if(1&o&&(t.TgZ(0,"mat-select",8),t.SjG(1,vt,2,2,"mat-option",20,t.x6l),t.YNc(3,xt,2,2,"mat-option",20),t.qZA()),2&o){const e=t.oxw(),n=t.oxw();t.xp6(1),t.wJu(n.targetTypeOptions),t.xp6(2),t.um2(3,e.unknownTargetType?3:-1)}}function Dt(o,r){1&o&&t._UZ(0,"input",9)}function Et(o,r){1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1," Warning: you entered an unknown target type. This may work or may not. Please be sure you know what you're doing "),t.qZA()),2&o&&t.Q6J("isError",!1)}function It(o,r){if(1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.Q6J("isError",!1),t.xp6(1),t.Oqu(e.targetTypeHint)}}function At(o,r){1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}function Ot(o,r){1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1," Must be a whole number "),t.qZA()),2&o&&t.Q6J("isError",!0)}function Pt(o,r){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function bt(o,r){1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}function Zt(o,r){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.StaticName),t.xp6(1),t.hij(" ",e.Label," ")}}function Ut(o,r){if(1&o&&(t.TgZ(0,"mat-form-field",7)(1,"mat-label"),t._uU(2,"Content Type"),t.qZA(),t.TgZ(3,"mat-select",21),t.SjG(4,Zt,2,2,"mat-option",20,t.x6l),t.qZA()()),2&o){const e=t.oxw();t.xp6(3),t.Q6J("placeholder",e.contentTypes.length?"":"No items found"),t.xp6(1),t.wJu(e.contentTypes)}}function Ft(o,r){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function St(o,r){if(1&o&&(t.TgZ(0,"mat-form-field",7)(1,"mat-label"),t._uU(2,"Scope"),t.qZA(),t.TgZ(3,"mat-select",22),t.SjG(4,Ft,2,2,"mat-option",20,t.x6l),t.TgZ(6,"mat-option",20),t._uU(7,"Other..."),t.qZA()()()),2&o){const e=t.oxw(),n=t.oxw();t.xp6(3),t.Q6J("placeholder",e.scopeOptions.length?"":"No items found"),t.xp6(1),t.wJu(e.scopeOptions),t.xp6(2),t.Q6J("value",n.dropdownInsertValue)}}function Rt(o,r){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.Guid),t.xp6(1),t.AsE(" ",e.Title," (",e.Id,") ")}}function Kt(o,r){if(1&o&&(t.TgZ(0,"mat-select",23),t.SjG(1,Rt,2,3,"mat-option",20,t.x6l),t.qZA()),2&o){const e=t.oxw(3);t.Q6J("placeholder",e.contentItems.length?"":"No items found"),t.xp6(1),t.wJu(e.contentItems)}}function $t(o,r){1&o&&t._UZ(0,"input",24)}function Nt(o,r){if(1&o&&t.YNc(0,Kt,3,1,"mat-select",23)(1,$t,1,0,"input",24),2&o){const e=t.oxw(2);t.um2(0,e.guidedKey?0:-1),t.xp6(1),t.um2(1,e.guidedKey?-1:1)}}function wt(o,r){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.StaticName),t.xp6(1),t.hij(" ",e.Label," ")}}function Lt(o,r){if(1&o&&(t.TgZ(0,"mat-select",23),t.SjG(1,wt,2,2,"mat-option",20,t.x6l),t.qZA()),2&o){const e=t.oxw(3);t.Q6J("placeholder",e.contentTypes.length?"":"No items found"),t.xp6(1),t.wJu(e.contentTypes)}}function Gt(o,r){1&o&&t._UZ(0,"input",24)}function Bt(o,r){if(1&o&&t.YNc(0,Lt,3,1,"mat-select",23)(1,Gt,1,0,"input",24),2&o){const e=t.oxw(2);t.um2(0,e.guidedKey?0:-1),t.xp6(1),t.um2(1,e.guidedKey?-1:1)}}function kt(o,r){1&o&&t.GkF(0)}function Jt(o,r){if(1&o&&t.YNc(0,kt,1,0,"ng-container",25),2&o){t.oxw(2);const e=t.MAs(39);t.Q6J("ngTemplateOutlet",e)}}function Wt(o,r){if(1&o&&t.YNc(0,Nt,2,2)(1,Bt,2,2)(2,Jt,1,1),2&o){const e=t.oxw(),n=t.oxw();let i;t.um2(0,(i=e.formValues.targetType)===n.eavConstants.metadata.entity.targetType?0:i===n.eavConstants.metadata.contentType.targetType?1:2)}}function Ht(o,r){1&o&&t._UZ(0,"input",24)}function Qt(o,r){1&o&&t._UZ(0,"input",26)}function jt(o,r){if(1&o&&t.YNc(0,Ht,1,0,"input",24)(1,Qt,1,0,"input",26),2&o){const e=t.oxw(),n=t.oxw();t.um2(0,e.formValues.keyType!==n.eavConstants.keyTypes.number?0:-1),t.xp6(1),t.um2(1,e.formValues.keyType===n.eavConstants.keyTypes.number?1:-1)}}function Yt(o,r){1&o&&t._UZ(0,"input",24)}function Vt(o,r){1&o&&t._UZ(0,"input",26)}function zt(o,r){if(1&o&&t.YNc(0,Yt,1,0,"input",24)(1,Vt,1,0,"input",26),2&o){const e=t.oxw(),n=t.oxw();t.um2(0,e.formValues.keyType!==n.eavConstants.keyTypes.number?0:-1),t.xp6(1),t.um2(1,e.formValues.keyType===n.eavConstants.keyTypes.number?1:-1)}}const z=o=>({active:o});function Xt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",27)(1,"button",28),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.toggleGuidedKey(!0))}),t.TgZ(2,"mat-icon",29),t._uU(3,"search"),t.qZA()(),t.TgZ(4,"button",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.toggleGuidedKey(!1))}),t.TgZ(5,"mat-icon",29),t._uU(6,"text_fields"),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(2,z,e.guidedKey)),t.xp6(3),t.Q6J("ngClass",t.VKq(4,z,!e.guidedKey))}}function qt(o,r){1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}function te(o,r){1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1," Must be a whole number "),t.qZA()),2&o&&t.Q6J("isError",!0)}function ee(o,r){1&o&&(t.TgZ(0,"app-field-hint",10),t._uU(1," Must be a valid GUID "),t.qZA()),2&o&&t.Q6J("isError",!0)}function ne(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3),t._uU(3,"Create Metadata"),t.qZA()(),t.TgZ(4,"div",4)(5,"p"),t._uU(6," This is a special operation to add an item which is metadata for another item, see "),t.TgZ(7,"a",5),t._uU(8,"docs"),t.qZA(),t._uU(9,". "),t.qZA(),t.TgZ(10,"form",6)(11,"mat-form-field",7)(12,"mat-label"),t._uU(13,"Target"),t.qZA(),t.YNc(14,Mt,4,1,"mat-select",8)(15,Dt,1,0,"input",9),t.qZA(),t.YNc(16,Et,2,1,"app-field-hint",10)(17,It,2,2,"app-field-hint",10)(18,At,2,1,"app-field-hint",10)(19,Ot,2,1,"app-field-hint",10),t.TgZ(20,"mat-form-field",7)(21,"mat-label"),t._uU(22,"Key type"),t.qZA(),t.TgZ(23,"mat-select",11),t.SjG(24,Pt,2,2,"mat-option",20,t.x6l),t.qZA()(),t.YNc(26,bt,2,1,"app-field-hint",10)(27,Ut,6,1,"mat-form-field",12)(28,St,8,2,"mat-form-field",12),t.TgZ(29,"app-field-hint"),t._uU(30," The scope should almost never be changed - "),t.TgZ(31,"a",13),t._uU(32,"see help"),t.qZA()(),t.TgZ(33,"mat-form-field",7)(34,"mat-label"),t._uU(35,"Key"),t.qZA(),t.YNc(36,Wt,3,1)(37,jt,2,2)(38,zt,2,2,"ng-template",null,14,t.W1O)(40,Xt,7,6,"div",15),t.qZA(),t.YNc(41,qt,2,1,"app-field-hint",10)(42,te,2,1,"app-field-hint",10)(43,ee,2,1,"app-field-hint",10),t.qZA()(),t.TgZ(44,"mat-dialog-actions",16)(45,"mat-slide-toggle",17),t.NdJ("change",function(i){t.CHM(e);const s=t.oxw();return t.KtG(s.toggleGuidedMode(i))}),t._uU(46),t.qZA(),t.TgZ(47,"div")(48,"button",18),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.closeDialog())}),t._uU(49,"Cancel"),t.qZA(),t.TgZ(50,"button",19),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirm())}),t._uU(51," Confirm "),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(10),t.Q6J("formGroup",e.form),t.xp6(4),t.um2(14,r.guidedMode?14:-1),t.xp6(1),t.um2(15,r.guidedMode?-1:15),t.xp6(1),t.um2(16,e.form.controls.targetType.touched&&!e.form.controls.targetType.invalid&&r.unknownTargetType?16:-1),t.xp6(1),t.um2(17,r.targetTypeHint?17:-1),t.xp6(1),t.um2(18,e.form.controls.targetType.touched&&null!=e.form.controls.targetType.errors&&e.form.controls.targetType.errors.required?18:-1),t.xp6(1),t.um2(19,e.form.controls.targetType.touched&&null!=e.form.controls.targetType.errors&&e.form.controls.targetType.errors.pattern?19:-1),t.xp6(5),t.wJu(r.keyTypeOptions),t.xp6(2),t.um2(26,e.form.controls.keyType.touched&&null!=e.form.controls.keyType.errors&&e.form.controls.keyType.errors.required?26:-1),t.xp6(1),t.um2(27,r.guidedMode&&r.formValues.targetType===e.eavConstants.metadata.entity.targetType?27:-1),t.xp6(1),t.um2(28,!r.guidedMode||r.formValues.targetType!==e.eavConstants.metadata.entity.targetType&&r.formValues.targetType!==e.eavConstants.metadata.contentType.targetType?-1:28),t.xp6(8),t.um2(36,r.guidedMode?36:37),t.xp6(4),t.um2(40,r.guidedMode&&r.guidedKeyExists?40:-1),t.xp6(1),t.um2(41,e.form.controls.key.touched&&null!=e.form.controls.key.errors&&e.form.controls.key.errors.required?41:-1),t.xp6(1),t.um2(42,e.form.controls.key.touched&&null!=e.form.controls.key.errors&&e.form.controls.key.errors.patternWholeNumber?42:-1),t.xp6(1),t.um2(43,e.form.controls.key.touched&&null!=e.form.controls.key.errors&&e.form.controls.key.errors.patternGuid?43:-1),t.xp6(2),t.Q6J("tippy",r.guidedMode?"Guided mode helps you select options that work":"Manual mode is for advanced uses and allows you to insert any values")("checked",r.guidedMode),t.xp6(1),t.hij(" ",r.guidedMode?"Guided":"Manual"," "),t.xp6(4),t.Q6J("disabled",!e.form.valid)}}let oe=(()=>{class o extends mt.f{constructor(e,n,i,s){super(),this.dialogRef=e,this.context=n,this.contentItemsService=i,this.contentTypesService=s,this.hostClass="dialog-component",this.eavConstants=M.Zy,this.dropdownInsertValue=Y.G}ngOnInit(){this.targetTypeOptions=Object.values(M.Zy.metadata).map(n=>({...n})),this.keyTypeOptions=Object.values(M.Zy.keyTypes),this.keyTypeOptions$=new c.X([]),this.scopeOptions$=new c.X([]),this.guidedMode$=new c.X(!0),this.contentItems$=new c.X([]),this.contentTypes$=new c.X([]),this.guidedKey$=new c.X(!0),this.fetchScopes(),this.form=new h.nJ({}),this.form.addControl("targetType",new h.p4(M.Zy.metadata.entity.targetType,[h.kI.required,h.kI.pattern(/^[0-9]+$/)])),this.form.addControl("keyType",new h.p4(M.Zy.metadata.entity.keyType,[h.kI.required])),this.form.addControl("contentTypeForContentItems",new h.p4(null)),this.form.addControl("scopeForContentTypes",new h.p4(M.Zy.scopes.default.value)),this.form.addControl("key",new h.p4(null,[h.kI.required,gt(this.form)])),this.subscription.add(this.form.controls.scopeForContentTypes.valueChanges.pipe((0,Q.O)(this.form.controls.scopeForContentTypes.value),(0,K.x)()).subscribe(n=>{null!=this.form.controls.contentTypeForContentItems.value&&this.form.controls.contentTypeForContentItems.patchValue(null),n===Y.G?(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||M.Zy.scopes.default.value,this.scopeOptions$.value.some(i=>i.value===n)||this.scopeOptions$.next([{name:n,value:n},...this.scopeOptions$.value]),this.form.controls.scopeForContentTypes.patchValue(n)):this.fetchContentTypes(n)})),this.subscription.add((0,pt.T)(this.form.controls.targetType.valueChanges.pipe((0,K.x)()),this.form.controls.keyType.valueChanges.pipe((0,K.x)())).subscribe(()=>{this.guidedKey$.next(!0),null!=this.form.getRawValue().key&&this.form.patchValue({key:null})})),this.subscription.add(this.form.controls.contentTypeForContentItems.valueChanges.pipe((0,Q.O)(this.form.controls.contentTypeForContentItems.value),(0,K.x)()).subscribe(n=>{const i=this.form.getRawValue();i.targetType===M.Zy.metadata.entity.targetType&&null!=i.key&&this.form.patchValue({key:null}),this.contentItemsService.getAll(n).subscribe(s=>{this.contentItems$.next(s)})}));const e=this.form.valueChanges.pipe((0,Q.O)(this.form.getRawValue()),(0,y.U)(()=>this.form.getRawValue()),(0,K.x)(R.iX.objectsEqual));this.subscription.add((0,p.a)([e,this.guidedMode$]).subscribe(([n,i])=>{const s=this.targetTypeOptions.find(J=>J.targetType===n.targetType),E=i&&s?[s.keyType]:[...this.keyTypeOptions];R.iX.arraysEqual(E,this.keyTypeOptions$.value)||this.keyTypeOptions$.next(E);const x={};this.keyTypeOptions$.value.includes(n.keyType)||(x.keyType=this.keyTypeOptions$.value[0]);const O=i&&n.targetType===M.Zy.metadata.app.targetType;O&&n.key!==this.context.appId&&(x.key=this.context.appId),Object.keys(x).length&&this.form.patchValue(x),R.iX.disableControl(this.form.controls.keyType,i&&this.keyTypeOptions$.value.length<=1),R.iX.disableControl(this.form.controls.key,O)})),this.viewModel$=(0,p.a)([(0,p.a)([this.guidedMode$,this.keyTypeOptions$,this.scopeOptions$,this.contentItems$,this.contentTypes$]),(0,p.a)([e,this.guidedKey$])]).pipe((0,y.U)(([[n,i,s,E,x],[O,w]])=>({guidedMode:n,unknownTargetType:!this.targetTypeOptions.some(L=>L.targetType===O.targetType),targetTypeHint:n&&this.targetTypeOptions.find(L=>L.targetType===O.targetType)?.hint,keyTypeOptions:i,scopeOptions:s,guidedKey:w,guidedKeyExists:[M.Zy.metadata.entity.targetType,M.Zy.metadata.contentType.targetType].includes(O.targetType),formValues:O,contentItems:E,contentTypes:x})))}ngOnDestroy(){this.guidedMode$.complete(),this.keyTypeOptions$.complete(),this.contentItems$.complete(),this.contentTypes$.complete(),this.guidedKey$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}toggleGuidedKey(e){this.guidedKey$.next(e)}toggleGuidedMode(e){this.guidedMode$.next(e.checked)}confirm(){const e=this.form.getRawValue(),n={target:this.targetTypeOptions.find(i=>i.targetType===e.targetType)?.target,targetType:e.targetType,keyType:e.keyType,key:e.keyType===M.Zy.keyTypes.guid?e.key.replace(/{|}/g,""):e.key.toString()};this.closeDialog(n)}fetchContentTypes(e){this.contentTypesService.retrieveContentTypes(e).subscribe(n=>{this.contentTypes$.next(n)})}fetchScopes(){this.contentTypesService.getScopes().subscribe(e=>{this.scopeOptions$.next(e)})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36($.so),t.Y36(_t._),t.Y36(V.l),t.Y36(ut.sF))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-metadata-dialog"]],hostVars:1,hostBindings:function(n,i){2&n&&t.Ikx("className",i.hostClass)},features:[t.qOj],decls:2,vars:3,consts:[["class","eav-dialog"],[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],[1,"eav-dialog-content"],["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",1,"eav-form-field"],["formControlName","targetType","required",""],["matInput","","type","number","min","0","formControlName","targetType","required",""],[3,"isError"],["formControlName","keyType","required",""],["color","accent","class","eav-form-field"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["defaultKeyInput",""],["matTextSuffix","","class","eav-selection-suffix"],[1,"eav-dialog-actions"],["color","accent",3,"tippy","checked","change"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],[3,"value"],["formControlName","contentTypeForContentItems",3,"placeholder"],["formControlName","scopeForContentTypes",3,"placeholder"],["formControlName","key","required","",3,"placeholder"],["matInput","","type","text","formControlName","key","required",""],[4,"ngTemplateOutlet"],["matInput","","type","number","formControlName","key","required",""],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"ngClass","click"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"ngClass","click"]],template:function(n,i){if(1&n&&(t.YNc(0,ne,52,19,"div",0),t.ALo(1,"async")),2&n){let s;t.um2(0,(s=t.lcZ(1,1,i.viewModel$))?0:-1,s)}},dependencies:[S.mk,S.tP,ft.Y,Ct.E,F.$,$.H8,N.lW,N.RK,B.Hw,h._Y,h.Fj,h.wV,h.JJ,h.JL,h.Q7,h.qQ,P.Nt,C.KE,C.hX,C.R9,Tt.gD,H.ey,h.sg,h.u,yt.Rr,S.Ov]})}return o})();var X=a(2106);let ie=(()=>{class o{constructor(){this.published="",this.metadata="",this.hasMetadata=""}agInit(e){this.filterParams=e}isFilterActive(){return""!==this.published||""!==this.metadata||""!==this.hasMetadata}doesFilterPass(e){let n=!1,i=!1,s=!1;const x=this.filterParams.valueGetter({api:this.filterParams.api,colDef:this.filterParams.colDef,column:this.filterParams.column,columnApi:this.filterParams.columnApi,context:this.filterParams.context,data:e.node.data,getValue:O=>e.node.data[O],node:e.node});return n=""===this.published||null!=x.published&&x.published.toString()===this.published,i=""===this.metadata||null!=x.metadata&&x.metadata.toString()===this.metadata,s=""===this.hasMetadata||null!=x.hasMetadata&&x.hasMetadata.toString()===this.hasMetadata,n&&i&&s}getModel(){return this.isFilterActive()?{filterType:"pub-meta",published:this.published,metadata:this.metadata,hasMetadata:this.hasMetadata}:void 0}setModel(e){this.published=e?e.published:"",this.metadata=e?e.metadata:"",this.hasMetadata=e?e.hasMetadata:""}afterGuiAttached(e){}filterChanged(){this.filterParams.filterChangedCallback()}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-pub-meta-filter"]],decls:27,vars:3,consts:[[1,"title"],[3,"ngModel","ngModelChange"],["value",""],["value","true"],["value","false"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t._uU(1,"Published"),t.qZA(),t.TgZ(2,"mat-radio-group",1),t.NdJ("ngModelChange",function(E){return i.published=E})("ngModelChange",function(){return i.filterChanged()}),t.TgZ(3,"mat-radio-button",2),t._uU(4,"All"),t.qZA(),t.TgZ(5,"mat-radio-button",3),t._uU(6,"Published"),t.qZA(),t.TgZ(7,"mat-radio-button",4),t._uU(8,"Not published"),t.qZA()(),t.TgZ(9,"div",0),t._uU(10,"Is Metadata"),t.qZA(),t.TgZ(11,"mat-radio-group",1),t.NdJ("ngModelChange",function(E){return i.metadata=E})("ngModelChange",function(){return i.filterChanged()}),t.TgZ(12,"mat-radio-button",2),t._uU(13,"All"),t.qZA(),t.TgZ(14,"mat-radio-button",3),t._uU(15,"Is metadata"),t.qZA(),t.TgZ(16,"mat-radio-button",4),t._uU(17,"Is not metadata"),t.qZA()(),t.TgZ(18,"div",0),t._uU(19,"Has Metadata"),t.qZA(),t.TgZ(20,"mat-radio-group",1),t.NdJ("ngModelChange",function(E){return i.hasMetadata=E})("ngModelChange",function(){return i.filterChanged()}),t.TgZ(21,"mat-radio-button",2),t._uU(22,"All"),t.qZA(),t.TgZ(23,"mat-radio-button",3),t._uU(24,"Has metadata"),t.qZA(),t.TgZ(25,"mat-radio-button",4),t._uU(26,"Has no metadata"),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("ngModel",i.published),t.xp6(9),t.Q6J("ngModel",i.metadata),t.xp6(9),t.Q6J("ngModel",i.hasMetadata))},dependencies:[h.JJ,h.On,X.VQ,X.U0],styles:[".title[_ngcontent-%COMP%]{padding:12px 12px 0}.mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;overflow:hidden;padding:12px;width:160px;height:104px}"]})}return o})();var ae=a(1092),j=a(91),se=a(9409),re=a(2849),le=a(40),de=a(8621),ce=a(6537);function pe(o,r){1&o&&(t._UZ(0,"div",6),t.ALo(1,"safeHtml")),2&o&&t.Q6J("innerHTML",t.lcZ(1,1,r),t.oJD)}function ue(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.debugFilter())}),t.TgZ(1,"mat-icon",12),t._uU(2,"filter_list"),t.qZA(),t.TgZ(3,"span"),t._uU(4,"Filter"),t.qZA()()}}function me(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3),t._uU(3),t.qZA(),t.TgZ(4,"button",4),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.closeDialog())}),t.TgZ(5,"mat-icon"),t._uU(6,"close"),t.qZA()()(),t.TgZ(7,"div",5),t._UZ(8,"router-outlet"),t.YNc(9,pe,2,3,"div",6),t.TgZ(10,"div",7)(11,"ag-grid-angular",8),t.NdJ("gridReady",function(i){t.CHM(e);const s=t.oxw();return t.KtG(s.onGridReady(i))})("filesDropped",function(i){t.CHM(e);const s=t.oxw();return t.KtG(s.filesDropped(i))}),t.qZA()()(),t.TgZ(12,"mat-dialog-actions",9)(13,"div",10)(14,"button",11),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.exportContent())}),t.TgZ(15,"mat-icon",12),t._uU(16,"cloud_download"),t.qZA(),t.TgZ(17,"span"),t._uU(18,"Data"),t.qZA()(),t.TgZ(19,"button",13),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.importContent())}),t.TgZ(20,"mat-icon",12),t._uU(21,"cloud_upload"),t.qZA(),t.TgZ(22,"span"),t._uU(23,"Data"),t.qZA()(),t.TgZ(24,"button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.importItem())}),t.TgZ(25,"mat-icon",12),t._uU(26,"cloud_upload"),t.qZA(),t.TgZ(27,"span"),t._uU(28,"Item"),t.qZA()(),t.TgZ(29,"button",15),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.createMetadata())}),t.TgZ(30,"mat-icon",12),t._uU(31,"local_offer"),t.qZA(),t.TgZ(32,"span"),t._uU(33,"Create Metadata"),t.qZA()(),t.YNc(34,ue,5,0,"button",16),t.qZA(),t.TgZ(35,"button",17),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.editItem(null))}),t.TgZ(36,"mat-icon"),t._uU(37,"add"),t.qZA()()()()}if(2&o){const e=t.oxw();let n;t.xp6(3),t.hij(" ",r.contentType.Label||r.contentType.Name," Data "),t.xp6(6),t.um2(9,(n=null==r.contentType||null==r.contentType.Properties?null:r.contentType.Properties.ListInstructions)?9:-1,n),t.xp6(2),t.Q6J("rowData",r.items)("gridOptions",e.gridOptions)("allowedFileTypes","xml,json"),t.xp6(23),t.um2(34,r.debugEnabled?34:-1)}}let _e=(()=>{class o extends d.H{constructor(e,n,i,s,E,x,O,w,J,L,he,ge){super(e,n),this.router=e,this.route=n,this.dialogRef=i,this.contentTypesService=s,this.contentItemsService=E,this.entitiesService=x,this.contentExportService=O,this.snackBar=w,this.globalConfigService=J,this.dialog=L,this.viewContainerRef=he,this.changeDetectorRef=ge,this.contentType$=new l.x,this.items$=new c.X(void 0),this.gridOptions={...b.f},this.gridApi$=new c.X(null),this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName")}ngOnInit(){this.fetchContentType(),this.fetchItems(),this.fetchColumns(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{this.fetchItems()})),this.viewModel$=(0,p.a)([this.contentType$,this.items$,this.globalConfigService.getDebugEnabled$()]).pipe((0,y.U)(([e,n,i])=>({contentType:e,items:n,debugEnabled:i})))}ngOnDestroy(){this.contentType$.complete(),this.items$.complete(),this.gridApi$.complete(),super.ngOnDestroy()}closeDialog(){this.dialogRef.close()}onGridReady(e){this.gridApi$.next(e.api)}fetchContentType(){this.contentTypesService.retrieveContentType(this.contentTypeStaticName).subscribe(e=>{this.contentType$.next(e)})}fetchItems(){this.contentItemsService.getAll(this.contentTypeStaticName).subscribe(e=>{this.items$.next(e)})}fetchColumns(){this.contentItemsService.getColumns(this.contentTypeStaticName).subscribe(e=>{const n=this.buildColumnDefs(e),i=function ct(o,r){if(!o)return;let e;"="===o.charAt(o.length-1)&&(o=atob(o));try{e=JSON.parse(o)}catch{console.error("Can't parse JSON with filters from url:",o)}if(!e)return;const n={};return(e.IsPublished||e.IsMetadata)&&(n.Status={filterType:"pub-meta",published:e.IsPublished??"",metadata:e.IsMetadata??"",hasMetadata:""}),Object.entries(e).filter(([i,s])=>"IsPublished"!==i&&"IsMetadata"!==i).forEach(([i,s])=>{if(r.find(x=>x.headerName===i)?.filter!==Z){if("string"==typeof s)n[i]={filterType:"text",type:"equals",filter:s};else if("number"==typeof s)n[i]={filterType:"number",type:"equals",filter:s,filterTo:null};else if("boolean"==typeof s){const x={filterType:"boolean",filter:s.toString()};n[i]=x}}else{const x={filterType:"entity",filter:"string"==typeof(s=R.iX.tryParse(s)??s)?s:void 0,idFilter:"number"==typeof s?[s]:Array.isArray(s)?s.filter(O=>"number"==typeof O):void 0};n[i]=x}}),n}(sessionStorage.getItem(G.JA),n);this.gridApi$.value?this.setColumnDefs(n,i):this.gridApi$.pipe((0,T.h)(s=>null!=s),(0,u.q)(1)).subscribe(s=>{this.setColumnDefs(n,i)})})}setColumnDefs(e,n){this.gridApi$.value.setColumnDefs(e),n&&((0,tt.P)("Will try to apply filter:",n),this.gridApi$.value.setFilterModel(n))}openMetadata(e){const n=g.U.getUrlEntity(e.Guid,`Metadata for Entity: ${e._Title} (${e.Id})`,this.contentTypeStaticName);this.router.navigate([n],{relativeTo:this.route})}editItem(e){const i=(0,W.f)({items:[null==e?{ContentTypeName:this.contentTypeStaticName}:{EntityId:e.Id}]});this.router.navigate([`edit/${i}`],{relativeTo:this.route})}exportContent(){const e=this.gridApi$.value.getFilterModel(),n=Object.keys(e).length>0,i=[];n&&this.gridApi$.value.forEachNodeAfterFilterAndSort(s=>{i.push(s.data.Id)}),this.router.navigate([`export/${this.contentTypeStaticName}${i.length>0?`/${i}`:""}`],{relativeTo:this.route})}filesDropped(e){const n=e[0];switch(n.name.substring(n.name.lastIndexOf(".")+1).toLocaleLowerCase()){case"xml":this.importContent(e);break;case"json":this.importItem(e)}}importContent(e){this.router.navigate([`${this.contentTypeStaticName}/import`],{relativeTo:this.route,state:{files:e}})}importItem(e){this.router.navigate(["import"],{relativeTo:this.route,state:{files:e}})}createMetadata(){this.dialog.open(oe,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(n=>{if(null==n)return;const i={items:[{ContentTypeName:this.contentTypeStaticName,For:{Target:n.target??n.targetType.toString(),TargetType:n.targetType,...n.keyType===M.Zy.keyTypes.guid&&{Guid:n.key},...n.keyType===M.Zy.keyTypes.number&&{Number:parseInt(n.key,10)},...n.keyType===M.Zy.keyTypes.string&&{String:n.key}}}]},s=(0,W.f)(i);this.router.navigate([`edit/${s}`],{relativeTo:this.route}),this.changeDetectorRef.markForCheck()})}debugFilter(){console.warn("Current filter:",this.gridApi$.value.getFilterModel()),this.snackBar.open("Check console for filter information",void 0,{duration:3e3})}buildColumnDefs(e){const n=[{headerName:"ID",field:"Id",width:70,headerClass:"dense",sortable:!0,filter:"agNumberColumnFilter",cellClass:i=>("id-action no-padding no-outline "+(i.data._EditInfo.ReadOnly?"disabled":"")).split(" "),valueGetter:i=>i.data.Id,cellRenderer:q.m,cellRendererParams:{tooltipGetter:s=>`ID: ${s.Id}\nRepoID: ${s._RepositoryId}\nGUID: ${s.Guid}`}},{field:"Status",width:82,headerClass:"dense",cellClass:"secondary-action no-padding".split(" "),filter:ie,valueGetter:i=>{const s=i.data;return{published:s.IsPublished,metadata:!!s.For,hasMetadata:!!s.Metadata&&s.Metadata.length>0}},cellRenderer:dt,cellRendererParams:(()=>({onOpenMetadata:s=>this.openMetadata(s)}))()},{headerName:"Item (Entity)",field:"_Title",flex:2,minWidth:250,cellClass:"primary-action highlight".split(" "),sortable:!0,filter:"agTextColumnFilter",onCellClicked:i=>{this.editItem(i.data)},valueGetter:i=>i.data._Title},{headerName:"Stats",headerTooltip:"Used by others / uses others",field:"_Used",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:i=>{const s=i.data;return`${s._Used} / ${s._Uses}`}},{cellClass:"secondary-action no-padding".split(" "),width:122,pinned:"right",cellRenderer:nt,cellRendererParams:(()=>({onClone:s=>this.clone(s),onExport:s=>this.export(s),onDelete:s=>this.delete(s)}))()}];for(const i of e){const s={headerName:i.StaticName,field:i.StaticName,flex:2,minWidth:250,cellClass:"no-outline",sortable:!0};switch(i.Type){case f.Q.Entity:s.allowMultiValue=i.Metadata?.Entity?.AllowMultiValue??!0,s.cellRenderer=it,s.valueGetter=this.valueGetterEntityField,s.filter=Z;break;case f.Q.DateTime:s.useTimePicker=i.Metadata?.DateTime?.UseTimePicker??!1,s.valueGetter=this.valueGetterDateTime,s.filter="agTextColumnFilter";break;case f.Q.Boolean:s.valueGetter=this.valueGetterBoolean,s.filter=I.U;break;case f.Q.Number:s.filter="agNumberColumnFilter";break;default:s.filter="agTextColumnFilter"}n.push(s)}return n}clone(e){const i=(0,W.f)({items:[{ContentTypeName:this.contentTypeStaticName,DuplicateEntity:e.Id}]});this.router.navigate([`edit/${i}`],{relativeTo:this.route})}export(e){this.contentExportService.exportEntity(e.Id,this.contentTypeStaticName,!0)}delete(e){confirm(`Delete '${e._Title}' (${e._RepositoryId})?`)&&(this.snackBar.open("Deleting..."),this.entitiesService.delete(this.contentTypeStaticName,e._RepositoryId,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchItems()},error:n=>{this.snackBar.dismiss(),confirm(`${n.error.ExceptionMessage}\n\nDo you want to force delete '${e._Title}' (${e._RepositoryId})?`)&&(this.snackBar.open("Deleting..."),this.entitiesService.delete(this.contentTypeStaticName,e._RepositoryId,!0).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchItems()}))}}))}valueGetterEntityField(e){const n=e.data[e.colDef.field];return 0===n.length?null:n.map(i=>i.Title)}valueGetterDateTime(e){const n=e.data[e.colDef.field];return n?e.colDef.useTimePicker?n.replace("T"," ").replace("Z",""):n.split("T")[0]:null}valueGetterBoolean(e){const n=e.data[e.colDef.field];return"boolean"!=typeof n?null:n.toString()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(j.F0),t.Y36(j.gz),t.Y36($.so),t.Y36(_.s),t.Y36(V.l),t.Y36(ae.g),t.Y36(D.i),t.Y36(se.ux),t.Y36(m.bE),t.Y36($.uw),t.Y36(t.s_b),t.Y36(t.sBO))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-content-items"]],features:[t.qOj],decls:2,vars:3,consts:[["appToggleDebug","","class","eav-dialog nav-component-wrapper"],["appToggleDebug","",1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[3,"innerHTML"],[1,"grid-wrapper"],["appDragAndDrop","",1,"ag-theme-material",3,"rowData","gridOptions","allowedFileTypes","gridReady","filesDropped"],[1,"eav-dialog-actions"],[1,"eav-dialog-actions-div"],["mat-button","","tippy","Export xml list",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"],["mat-button","","tippy","Import xml list",1,"eav-button__with-icon",3,"click"],["mat-button","","tippy","Import single json item",1,"eav-button__with-icon",3,"click"],["mat-button","","tippy","Create metadata",1,"eav-button__with-icon",3,"click"],["mat-button","","class","eav-button__with-icon","color","accent","tippy","Print filter to console"],["mat-fab","","mat-elevation-z24","","tippy","Add item",1,"grid-fab",3,"click"],["mat-button","","color","accent","tippy","Print filter to console",1,"eav-button__with-icon",3,"click"]],template:function(n,i){if(1&n&&(t.YNc(0,me,38,6,"div",0),t.ALo(1,"async")),2&n){let s;t.um2(0,(s=t.lcZ(1,1,i.viewModel$))?0:-1,s)}},dependencies:[j.lC,re.z,le.D,F.$,$.H8,N.lW,N.RK,N.cs,B.Hw,de.N8,S.Ov,ce.z]})}return o})()},4173:(A,v,a)=>{a.d(v,{H:()=>D,a:()=>f});var l=a(1891),c=a(4980),p=a(7503),y=a(2611),T=a(9039),u=a(4860),_=a(6232);const D="admin/app/";let f=(()=>{class m{constructor(d,I,t){this.http=d,this.context=I,this.dnnContext=t}importApp(d,I,t=!1){const C=new FormData;return C.append("File",d),C.append("Name",I??""),this.http.post(this.dnnContext.$2sxc.http.apiUrl(D+"Import"),C,{params:{zoneId:this.context.zoneId.toString()}}).pipe((0,l.w)(h=>{if(t&&h.Messages[0]?.MessageType===p.DS.Warning){const P=prompt(h.Messages[0].Text+" Would you like to install it using another folder name?");if(P)return this.importApp(d,P,!0)}return(0,c.of)(h)}))}static#t=this.\u0275fac=function(I){return new(I||m)(T.LFG(u.eN),T.LFG(y._),T.LFG(_._y))};static#e=this.\u0275prov=T.Yz7({token:m,factory:m.\u0275fac})}return m})()},6041:(A,v,a)=>{a.d(v,{H:()=>D});var l=a(91),c=a(4520),p=a(5043),y=a(9736),T=a(9422),u=a(9097),_=a(9039);let D=(()=>{class f extends u.f{constructor(g,d){super(),this.router=g,this.route=d}ngOnDestroy(){super.ngOnDestroy()}refreshOnChildClosedDeep(){return this.router.events.pipe((0,c.h)(g=>g instanceof l.m2),(0,p.O)(!!this.route.snapshot.firstChild.firstChild),(0,y.U)(()=>!!this.route.snapshot.firstChild.firstChild),(0,T.G)(),(0,c.h)(([g,d])=>g&&!d))}refreshOnChildClosedShallow(){return this.router.events.pipe((0,c.h)(g=>g instanceof l.m2),(0,p.O)(!!this.route.snapshot.firstChild),(0,y.U)(()=>!!this.route.snapshot.firstChild),(0,T.G)(),(0,c.h)(([g,d])=>g&&!d))}static#t=this.\u0275fac=function(d){return new(d||f)(_.Y36(l.F0),_.Y36(l.gz))};static#e=this.\u0275dir=_.lG2({type:f,features:[_.qOj]})}return f})()},9851:(A,v,a)=>{a.d(v,{Y:()=>g});var l=a(9039),c=a(6575),p=a(1268);function y(d,I){1&d&&l.GkF(0)}function T(d,I){if(1&d&&(l.TgZ(0,"mat-hint"),l.YNc(1,y,1,0,"ng-container",2),l.qZA()),2&d){l.oxw();const t=l.MAs(4);l.xp6(1),l.Q6J("ngTemplateOutlet",t)}}function u(d,I){1&d&&l.GkF(0)}function _(d,I){if(1&d&&(l.TgZ(0,"mat-error"),l.YNc(1,u,1,0,"ng-container",2),l.qZA()),2&d){l.oxw();const t=l.MAs(4);l.xp6(1),l.Q6J("ngTemplateOutlet",t)}}function D(d,I){1&d&&l.Hsn(0)}const f=d=>({"hint-box__short":d}),m=["*"];let g=(()=>{class d{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(C){return new(C||d)};static#e=this.\u0275cmp=l.Xpm({type:d,selectors:[["app-field-hint"]],inputs:{isError:"isError"},ngContentSelectors:m,decls:5,vars:4,consts:[[1,"hint-box",3,"ngClass","click"],["content",""],[4,"ngTemplateOutlet"]],template:function(C,h){if(1&C&&(l.F$t(),l.TgZ(0,"div",0),l.NdJ("click",function(){return h.toggleIsShort()}),l.YNc(1,T,2,1)(2,_,2,1),l.qZA(),l.YNc(3,D,1,0,"ng-template",null,1,l.W1O)),2&C){let P;l.Q6J("ngClass",l.VKq(2,f,h.isShort)),l.xp6(1),l.um2(1,!1===(P=h.isError)?1:!0===P?2:-1)}},dependencies:[c.mk,c.tP,p.bx,p.TO],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return d})()},5253:(A,v,a)=>{a.d(v,{m:()=>f});var l=a(4472),c=a(9039),p=a(9409),y=a(6575),T=a(257),u=a(6515),_=a(9498);const D=(m,g)=>({"align-start":m,"align-end":g});let f=(()=>{class m{constructor(d){this.snackBar=d}agInit(d){this.id=d.value,this.align="number"==typeof this.id?"end":"start",this.tooltip=d.tooltipGetter(d.data)}refresh(d){return!0}copy(){(0,l.v)(this.tooltip),this.snackBar.open("Copied to clipboard",null,{duration:2e3})}static#t=this.\u0275fac=function(I){return new(I||m)(c.Y36(p.ux))};static#e=this.\u0275cmp=c.Xpm({type:m,selectors:[["app-id-field"]],decls:5,vars:6,consts:[["matRipple","",1,"id-box","highlight",3,"tippy","ngClass","click"],[1,"id"],[1,"icon"]],template:function(I,t){1&I&&(c.TgZ(0,"div",0),c.NdJ("click",function(){return t.copy()}),c.TgZ(1,"span",1),c._uU(2),c.qZA(),c.TgZ(3,"mat-icon",2),c._uU(4,"file_copy"),c.qZA()()),2&I&&(c.Q6J("tippy",t.tooltip)("ngClass",c.WLB(3,D,"start"===t.align,"end"===t.align)),c.xp6(2),c.Oqu(t.id))},dependencies:[y.mk,T.wG,u.Hw,_.$],styles:[".id-box[_ngcontent-%COMP%]{padding:0 8px;height:100%;display:flex;align-items:center}.id-box.align-start[_ngcontent-%COMP%]{justify-content:flex-start}.id-box.align-end[_ngcontent-%COMP%]{justify-content:flex-end}.id-box[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{max-width:100%;text-overflow:ellipsis;overflow:hidden}.id-box[_ngcontent-%COMP%]:hover{text-decoration:none}.id-box[_ngcontent-%COMP%]:hover   .id[_ngcontent-%COMP%]{display:none}.id-box[_ngcontent-%COMP%]:not(:hover)   .icon[_ngcontent-%COMP%]{display:none}"]})}return m})()},6433:(A,v,a)=>{a.d(v,{f:()=>l});const l={accentedSort:!0,animateRows:!0,enableCellTextSelection:!0,headerHeight:32,suppressScrollOnNewData:!0,valueCache:!0,defaultColDef:{filterParams:{newRowsAction:"keep"}},tooltipShowDelay:0,tooltipHideDelay:1e5,suppressMovableColumns:!0}},131:(A,v,a)=>{a.d(v,{E:()=>c});var l=a(9039);let c=(()=>{class p{onClick(T){T.stopPropagation()}static#t=this.\u0275fac=function(u){return new(u||p)};static#e=this.\u0275dir=l.lG2({type:p,selectors:[["","appClickStopPropagation",""]],hostBindings:function(u,_){1&u&&l.NdJ("click",function(f){return _.onClick(f)})}})}return p})()},40:(A,v,a)=>{a.d(v,{D:()=>p});var l=a(716),c=a(9039);let p=(()=>{class y{constructor(u){this.globalConfigService=u}onClick(u){(navigator.platform.match("Mac")?u.metaKey:u.ctrlKey)&&u.shiftKey&&u.altKey&&(this.globalConfigService.toggleDebugEnabled(),window.getSelection().removeAllRanges())}static#t=this.\u0275fac=function(_){return new(_||y)(c.Y36(l.bE))};static#e=this.\u0275dir=c.lG2({type:y,selectors:[["","appToggleDebug",""]],hostBindings:function(_,D){1&_&&c.NdJ("click",function(m){return D.onClick(m)})}})}return y})()},4472:(A,v,a)=>{function l(c){const p=document.createElement("textarea");p.value=c,p.setAttribute("readonly",""),p.style.position="absolute",p.style.left="-9999px",document.body.appendChild(p);const y=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);p.select(),document.execCommand("copy"),document.body.removeChild(p),y&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(y))}a.d(v,{v:()=>l})}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.01.05/dist/ng-edit/projects_eav-ui_src_app_content-items_content-items_component_ts.9f5d9b4117b47831.js.map