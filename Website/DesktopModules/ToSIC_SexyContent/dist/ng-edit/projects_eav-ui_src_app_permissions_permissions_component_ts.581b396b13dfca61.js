"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_permissions_permissions_component_ts"],{8660:(P,m,e)=>{e.r(m),e.d(m,{PermissionsComponent:()=>A});var c=e(8071),n=e(3839),l=e(9736),u=e(6041),v=e(5253),C=e(6433),d=e(196),T=e(2957),t=e(9039),h=e(9498),r=e(6515),a=e(257);let y=(()=>{class p{agInit(s){this.params=s}refresh(s){return!0}deletePermission(){this.params.onDelete(this.params.data)}static#t=this.\u0275fac=function(i){return new(i||p)};static#e=this.\u0275cmp=t.Xpm({type:p,selectors:[["app-permissions-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(i,o){1&i&&(t.TgZ(0,"div",0)(1,"div",1),t.NdJ("click",function(){return o.deletePermission()}),t.TgZ(2,"mat-icon"),t._uU(3,"delete"),t.qZA()()())},dependencies:[h.$,r.Hw,a.wG]})}return p})();var g=e(7782),O=e(91),_=e(6861),M=e(9409),D=e(895),E=e(8621),x=e(6575);function I(p,R){if(1&p){const s=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3),t._uU(3,"Permissions"),t.qZA(),t.TgZ(4,"button",4),t.NdJ("click",function(){t.CHM(s);const o=t.oxw();return t.KtG(o.closeDialog())}),t.TgZ(5,"mat-icon"),t._uU(6,"close"),t.qZA()()(),t.TgZ(7,"div",5),t._UZ(8,"router-outlet"),t.TgZ(9,"div",6),t._UZ(10,"ag-grid-angular",7),t.qZA(),t.TgZ(11,"mat-dialog-actions",8)(12,"button",9),t.NdJ("click",function(){t.CHM(s);const o=t.oxw();return t.KtG(o.editPermission(null))}),t.TgZ(13,"mat-icon"),t._uU(14,"add"),t.qZA()()()()()}if(2&p){const s=t.oxw();t.xp6(10),t.Q6J("rowData",R.permissions)("gridOptions",s.gridOptions)}}let A=(()=>{class p extends u.H{constructor(s,i,o,f,Z){super(s,i),this.router=s,this.route=i,this.dialogRef=o,this.permissionsService=f,this.snackBar=Z,this.permissions$=new c.X(void 0),this.gridOptions=this.buildGridOptions(),this.targetType=parseInt(this.route.snapshot.paramMap.get("targetType"),10),this.keyType=this.route.snapshot.paramMap.get("keyType"),this.key=this.route.snapshot.paramMap.get("key"),this.prefills={[d.Zy.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.fetchPermissions(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{this.fetchPermissions()})),this.viewModel$=(0,n.a)([this.permissions$]).pipe((0,l.U)(([s])=>({permissions:s})))}ngOnDestroy(){this.permissions$.complete(),super.ngOnDestroy()}closeDialog(){this.dialogRef.close()}fetchPermissions(){this.permissionsService.getAll(this.targetType,this.keyType,this.key).subscribe(s=>{this.permissions$.next(s)})}editPermission(s){let i;i=null==s?{items:[{ContentTypeName:d.Zy.contentTypes.permissions,For:{Target:Object.values(d.Zy.metadata).find(f=>f.targetType===this.targetType)?.target??this.targetType.toString(),TargetType:this.targetType,...this.keyType===d.Zy.keyTypes.guid&&{Guid:this.key},...this.keyType===d.Zy.keyTypes.number&&{Number:parseInt(this.key,10)},...this.keyType===d.Zy.keyTypes.string&&{String:this.key}},...this.prefills[this.targetType]&&{Prefill:this.prefills[this.targetType]}}]}:{items:[{EntityId:s.Id}]};const o=(0,T.f)(i);this.router.navigate([`edit/${o}`],{relativeTo:this.route})}deletePermission(s){confirm(`Delete '${s.Title}' (${s.Id})?`)&&(this.snackBar.open("Deleting..."),this.permissionsService.delete(s.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchPermissions()}))}buildGridOptions(){return{...C.f,columnDefs:[{headerName:"ID",field:"Id",width:70,headerClass:"dense",cellClass:"id-action no-padding no-outline".split(" "),sortable:!0,filter:"agNumberColumnFilter",valueGetter:i=>i.data.Id,cellRenderer:v.m,cellRendererParams:{tooltipGetter:o=>`ID: ${o.Id}\nGUID: ${o.Guid}`}},{field:"Name",flex:2,minWidth:250,cellClass:"primary-action highlight".split(" "),sortable:!0,sort:"asc",filter:"agTextColumnFilter",onCellClicked:i=>{this.editPermission(i.data)},valueGetter:i=>i.data.Title},{field:"Identity",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:i=>i.data.Identity},{field:"Condition",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:i=>i.data.Condition},{field:"Grant",width:70,headerClass:"dense",cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:i=>i.data.Grant},{width:42,cellClass:"secondary-action no-padding".split(" "),pinned:"right",cellRenderer:y,cellRendererParams:(()=>({onDelete:o=>this.deletePermission(o)}))()}]}}static#t=this.\u0275fac=function(i){return new(i||p)(t.Y36(O.F0),t.Y36(O.gz),t.Y36(_.so),t.Y36(g.q),t.Y36(M.ux))};static#e=this.\u0275cmp=t.Xpm({type:p,selectors:[["app-permissions"]],features:[t.qOj],decls:2,vars:3,consts:[["class","eav-dialog nav-component-wrapper"],[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(i,o){if(1&i&&(t.YNc(0,I,15,2,"div",0),t.ALo(1,"async")),2&i){let f;t.um2(0,(f=t.lcZ(1,1,o.viewModel$))?0:-1,f)}},dependencies:[O.lC,h.$,_.H8,D.RK,D.cs,r.Hw,E.N8,x.Ov]})}return p})()},6041:(P,m,e)=>{e.d(m,{H:()=>T});var c=e(91),n=e(4520),l=e(5043),u=e(9736),v=e(9422),C=e(9097),d=e(9039);let T=(()=>{class t extends C.f{constructor(r,a){super(),this.router=r,this.route=a}ngOnDestroy(){super.ngOnDestroy()}refreshOnChildClosedDeep(){return this.router.events.pipe((0,n.h)(r=>r instanceof c.m2),(0,l.O)(!!this.route.snapshot.firstChild.firstChild),(0,u.U)(()=>!!this.route.snapshot.firstChild.firstChild),(0,v.G)(),(0,n.h)(([r,a])=>r&&!a))}refreshOnChildClosedShallow(){return this.router.events.pipe((0,n.h)(r=>r instanceof c.m2),(0,l.O)(!!this.route.snapshot.firstChild),(0,u.U)(()=>!!this.route.snapshot.firstChild),(0,v.G)(),(0,n.h)(([r,a])=>r&&!a))}static#t=this.\u0275fac=function(a){return new(a||t)(d.Y36(c.F0),d.Y36(c.gz))};static#e=this.\u0275dir=d.lG2({type:t,features:[d.qOj]})}return t})()},5253:(P,m,e)=>{e.d(m,{m:()=>t});var c=e(4472),n=e(9039),l=e(9409),u=e(6575),v=e(257),C=e(6515),d=e(9498);const T=(h,r)=>({"align-start":h,"align-end":r});let t=(()=>{class h{constructor(a){this.snackBar=a}agInit(a){this.id=a.value,this.align="number"==typeof this.id?"end":"start",this.tooltip=a.tooltipGetter(a.data)}refresh(a){return!0}copy(){(0,c.v)(this.tooltip),this.snackBar.open("Copied to clipboard",null,{duration:2e3})}static#t=this.\u0275fac=function(y){return new(y||h)(n.Y36(l.ux))};static#e=this.\u0275cmp=n.Xpm({type:h,selectors:[["app-id-field"]],decls:5,vars:6,consts:[["matRipple","",1,"id-box","highlight",3,"tippy","ngClass","click"],[1,"id"],[1,"icon"]],template:function(y,g){1&y&&(n.TgZ(0,"div",0),n.NdJ("click",function(){return g.copy()}),n.TgZ(1,"span",1),n._uU(2),n.qZA(),n.TgZ(3,"mat-icon",2),n._uU(4,"file_copy"),n.qZA()()),2&y&&(n.Q6J("tippy",g.tooltip)("ngClass",n.WLB(3,T,"start"===g.align,"end"===g.align)),n.xp6(2),n.Oqu(g.id))},dependencies:[u.mk,v.wG,C.Hw,d.$],styles:[".id-box[_ngcontent-%COMP%]{padding:0 8px;height:100%;display:flex;align-items:center}.id-box.align-start[_ngcontent-%COMP%]{justify-content:flex-start}.id-box.align-end[_ngcontent-%COMP%]{justify-content:flex-end}.id-box[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{max-width:100%;text-overflow:ellipsis;overflow:hidden}.id-box[_ngcontent-%COMP%]:hover{text-decoration:none}.id-box[_ngcontent-%COMP%]:hover   .id[_ngcontent-%COMP%]{display:none}.id-box[_ngcontent-%COMP%]:not(:hover)   .icon[_ngcontent-%COMP%]{display:none}"]})}return h})()},6433:(P,m,e)=>{e.d(m,{f:()=>c});const c={accentedSort:!0,animateRows:!0,enableCellTextSelection:!0,headerHeight:32,suppressScrollOnNewData:!0,valueCache:!0,defaultColDef:{filterParams:{newRowsAction:"keep"}},tooltipShowDelay:0,tooltipHideDelay:1e5,suppressMovableColumns:!0}},4472:(P,m,e)=>{function c(n){const l=document.createElement("textarea");l.value=n,l.setAttribute("readonly",""),l.style.position="absolute",l.style.left="-9999px",document.body.appendChild(l);const u=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);l.select(),document.execCommand("copy"),document.body.removeChild(l),u&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(u))}e.d(m,{v:()=>c})}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.01.02/dist/ng-edit/projects_eav-ui_src_app_permissions_permissions_component_ts.581b396b13dfca61.js.map