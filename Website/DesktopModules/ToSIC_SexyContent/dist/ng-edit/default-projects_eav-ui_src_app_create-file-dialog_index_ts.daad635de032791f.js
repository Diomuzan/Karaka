"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_index_ts"],{1485:(Y,$,a)=>{a.d($,{t:()=>K});var m=a(9736),M=a(2611),P=a(9039),O=a(4860),g=a(6232);const x="admin/AppFiles/asset";let K=(()=>{class T{constructor(i,r,d){this.http=i,this.context=r,this.dnnContext=d}get(i,r,d){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(x),{params:{appId:this.context.appId,global:r,...this.templateIdOrPath(i,r,d)}}).pipe((0,m.U)(h=>{if("auto"===h.Type.toLocaleLowerCase())switch(h.Extension.toLocaleLowerCase()){case".cs":case".cshtml":h.Type="Razor";break;case".html":case".css":case".js":h.Type="Token"}return h}))}save(i,r,d,h){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(x),d,{params:{appId:this.context.appId,global:r,...this.templateIdOrPath(i,r,h)}})}getAll(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:{appId:this.context.appId,...i&&{mask:i}}}).pipe((0,m.U)(({Files:r})=>(r.forEach(d=>{d.Shared??=!1}),r)))}getWebApis(){return this.getAll("*Controller.cs").pipe((0,m.U)(i=>i.map(d=>{const h=d.Path.lastIndexOf("/"),y=d.Path.lastIndexOf("."),N=d.Path.substring(0,h),S=d.Path.substring(h+1,y);return{path:d.Path,folder:N,name:S,isShared:d.Shared}})))}getWebApiDetails(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:i}})}getPredefinedTemplates(i,r){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:{...i&&{purpose:i},...r&&{type:r}}})}getPreview(i,r,d){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:i,templateKey:d,global:r}})}create(i,r,d){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:r,purpose:"auto",path:i,templateKey:d}})}templateIdOrPath(i,r,d){if(/^[0-9]*$/g.test(i)){const h=d.find(y=>y.EntityId?.toString()===i&&y.IsShared===r)?.Path;return{templateId:i,...null!=h&&{path:h}}}return{path:i}}static#t=this.\u0275fac=function(r){return new(r||T)(P.LFG(O.eN),P.LFG(M._),P.LFG(g._y))};static#e=this.\u0275prov=P.Yz7({token:T,factory:T.\u0275fac})}return T})()},7220:(Y,$,a)=>{a.d($,{UH:()=>nt,qH:()=>rt});var m=a(8849),M=a(6861),P=a(8071),O=a(3839),g=a(5043),C=a(3317),x=a(9736),D=a(3738),I=a(7777),E=a(4114),w=a(5678),K=a(384),j=a(9378);var r=a(1891),d=a(4980),h=a(4300),y=a(1485),N=a(926),S=a(9097),t=a(9039),V=a(6575),W=a(9851),J=a(9674);let Q=(()=>{class o{constructor(e,n){this.matInput=e,this.elementRef=n,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const n=e.toLocaleLowerCase();return"true"===n||"false"!==n&&void 0}return null==e?e:void 0}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(J.Nt),t.Y36(t.SBq))};static#e=this.\u0275dir=t.lG2({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}})}return o})();var z=a(895),Z=a(1268),L=a(6355),_=a(257),G=a(3910);function H(o,s){if(1&o&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function X(o,s){if(1&o&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function q(o,s){if(1&o&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.Key),t.xp6(1),t.hij(" ",e.Name," ")}}function k(o,s){1&o&&(t.TgZ(0,"app-field-hint",16),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}function tt(o,s){1&o&&t._UZ(0,"mat-spinner",22)(1,"div",23)}const B=o=>({disabled:o});function et(o,s){if(1&o&&(t.TgZ(0,"div",24)(1,"label",25),t._uU(2,"Preview"),t.qZA()(),t.TgZ(3,"pre",26),t._uU(4),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(3,B,e.loadingPreview)),t.xp6(2),t.Q6J("ngClass",t.VKq(5,B,e.loadingPreview)),t.xp6(1),t.Oqu(e.preview)}}function ot(o,s){if(1&o&&(t.TgZ(0,"div",27),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.hij(" ",e.previewError," ")}}function at(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"span"),t._uU(4,"Create"),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.qZA()()(),t.TgZ(7,"div",5)(8,"form",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"mat-form-field",10)(13,"mat-label"),t._uU(14,"Platform"),t.qZA(),t.TgZ(15,"mat-select",11),t.SjG(16,H,2,2,"mat-option",21,t.x6l),t.qZA()()(),t.TgZ(18,"div",9)(19,"mat-form-field",10)(20,"mat-label"),t._uU(21,"Purpose"),t.qZA(),t.TgZ(22,"mat-select",12),t.SjG(23,X,2,2,"mat-option",21,t.x6l),t.qZA()()()(),t.TgZ(25,"div",13)(26,"mat-form-field",10)(27,"mat-label"),t._uU(28,"Template"),t.qZA(),t.TgZ(29,"mat-select",14),t.SjG(30,q,2,2,"mat-option",21,t.x6l),t.qZA()()(),t.TgZ(32,"div",13)(33,"mat-form-field",10)(34,"mat-label"),t._uU(35,"Name"),t.qZA(),t._UZ(36,"input",15),t.qZA(),t.YNc(37,k,2,1,"app-field-hint",16),t.qZA()(),t.TgZ(38,"div",17),t.YNc(39,tt,2,0),t.TgZ(40,"button",18),t.NdJ("click",function(){t.CHM(e);const u=t.oxw();return t.KtG(u.closeDialog())}),t._uU(41,"Cancel"),t.qZA(),t.TgZ(42,"button",19),t.NdJ("click",function(){t.CHM(e);const u=t.oxw();return t.KtG(u.confirm())}),t._uU(43," Create "),t.qZA()(),t.YNc(44,et,5,7)(45,ot,2,1,"div",20),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(6),t.Oqu(e.controls.finalName.value||(e.controls.folder.value?e.controls.folder.value.trim()+"/":"")),t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(8),t.wJu(s.platforms),t.xp6(7),t.wJu(s.purposes),t.xp6(7),t.wJu(s.templates),t.xp6(7),t.um2(37,e.controls.name.touched&&null!=e.controls.name.errors&&e.controls.name.errors.required?37:-1),t.xp6(2),t.um2(39,s.loadingPreview?39:-1),t.xp6(3),t.Q6J("disabled",!e.form.valid||s.loadingPreview||!s.previewValid),t.xp6(2),t.um2(44,s.preview?44:-1),t.xp6(1),t.um2(45,!s.loadingPreview&&s.previewError?45:-1)}}let nt=(()=>{class o extends S.f{constructor(e,n,u){super(),this.dialogData=e,this.dialogRef=n,this.sourceService=u,this.hostClass="dialog-component",this.all="All"}ngOnInit(){this.templates$=new P.X([]),this.loadingPreview$=new P.X(!1),this.buildForm(),this.fetchTemplates(),this.buildViewModel()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){this.form=new m.nJ({platform:new m.p4(this.all),purpose:new m.p4({value:this.dialogData.purpose??this.all,disabled:null!=this.dialogData.purpose}),templateKey:new m.p4(null,m.kI.required),name:new m.p4(this.dialogData.name??null,m.kI.required),finalName:new m.p4({value:null,disabled:!0}),folder:new m.p4({value:this.dialogData.folder??"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,O.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.O)(this.controls.templateKey.value),(0,C.x)())]).subscribe(([e,n])=>{const u=e.find(p=>p.Key===n),f=this.dialogData.name?this.controls.name.value||this.dialogData.name:u?.SuggestedFileName??null;this.controls.name.value!==f&&this.controls.name.patchValue(f)})),this.subscription.add((0,O.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,g.O)(this.controls.templateKey.value),(0,C.x)()),this.controls.name.valueChanges.pipe((0,g.O)(this.controls.name.value),(0,C.x)()),this.controls.folder.valueChanges.pipe((0,g.O)(this.controls.folder.value),(0,C.x)())]).subscribe(([e,n,u,f])=>{const p=e.find(c=>c.Key===n);let l=null;u&&(f=f.trim(),u=N.vl.sanitizePath(u.trim()),l=`${f?`${f}/`:""}${u=`${p?.Prefix??""}${u}${p?.Suffix??""}${p?.Extension??""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==l&&this.controls.finalName.patchValue(l)}))}buildViewModel(){const e=this.templates$.pipe((0,x.U)(p=>{const l={[this.all]:this.all};return p.forEach(c=>{c.Platforms?.forEach(v=>{l[v]=v})}),Object.keys(l)})),n=this.templates$.pipe((0,x.U)(p=>{const l={[this.all]:this.all};return p.forEach(c=>{l[c.Purpose]=c.Purpose}),Object.keys(l)})),u=(0,O.a)([this.templates$,this.controls.platform.valueChanges.pipe((0,g.O)(this.controls.platform.value),(0,C.x)()),this.controls.purpose.valueChanges.pipe((0,g.O)(this.controls.purpose.value),(0,C.x)())]).pipe((0,x.U)(([p,l,c])=>p.filter(b=>(l===this.all||(b.Platforms?.includes(l)??!1))&&(c===this.all||b.Purpose===c))),(0,D.b)(p=>{if(!p.some(l=>l.Key===this.controls.templateKey.value)){const l=p[0]?.Key??null;this.controls.templateKey.value!==l&&this.controls.templateKey.patchValue(l)}})),f=(0,O.a)([this.controls.finalName.valueChanges.pipe((0,g.O)(this.controls.finalName.value),(0,C.x)()),this.controls.templateKey.valueChanges.pipe((0,g.O)(this.controls.templateKey.value),(0,C.x)())]).pipe(function i(o,s=I.z,e){const n=(0,j.H)(o,s);return function T(o,s){return(0,E.e)((e,n)=>{const{leading:u=!0,trailing:f=!1}=s??{};let p=!1,l=null,c=null,v=!1;const b=()=>{c?.unsubscribe(),c=null,f&&(R(),v&&n.complete())},F=()=>{c=null,v&&n.complete()},U=A=>c=(0,K.Xf)(o(A)).subscribe((0,w.x)(n,b,F)),R=()=>{if(p){p=!1;const A=l;l=null,n.next(A),!v&&U(A)}};e.subscribe((0,w.x)(n,A=>{p=!0,l=A,(!c||c.closed)&&(u?R():U(A))},()=>{v=!0,(!(f&&p&&c)||c.closed)&&n.complete()}))})}(()=>n,e)}(100,I.z,{leading:!0,trailing:!0}),(0,D.b)(()=>{this.loadingPreview$.next(!0)}),(0,r.w)(([p,l])=>p&&l?(0,h.D)([this.sourceService.getPreview(p,this.dialogData.global,l),(0,j.H)(500)]).pipe((0,x.U)(([c])=>c)):(0,d.of)(void 0)),(0,D.b)(()=>{this.loadingPreview$.next(!1)}));this.viewModel$=(0,O.a)([e,n,u,f,this.loadingPreview$]).pipe((0,x.U)(([p,l,c,v,b])=>({platforms:p,purposes:l,templates:c,loadingPreview:b,preview:v?.Preview,previewValid:v?.IsValid??!1,previewError:v?.Error})))}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(M.WI),t.Y36(M.so),t.Y36(y.t))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(n,u){2&n&&t.Ikx("className",u.hostClass)},features:[t.qOj],decls:2,vars:3,consts:[["class","eav-dialog eav-no-scrollbar"],[1,"eav-dialog","eav-no-scrollbar"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title","eav-dialog-title-box"],[1,"eav-file-name"],[1,"eav-dialog-content"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content"],[1,"eav-field-container","eav-multiple"],[1,"eav-multiple-field"],["color","accent",1,"eav-form-field"],["formControlName","platform"],["formControlName","purpose"],[1,"eav-field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","eav-preview-error"],[3,"value"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"eav-preview-label-box"],[1,"eav-preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"eav-preview-error"]],template:function(n,u){if(1&n&&(t.YNc(0,at,46,7,"div",0),t.ALo(1,"async")),2&n){let f;t.um2(0,(f=t.lcZ(1,1,u.viewModel$))?0:-1,f)}},dependencies:[V.mk,W.Y,Q,z.lW,Z.KE,Z.hX,L.gD,_.ey,m._Y,m.Fj,m.JJ,m.JL,m.Q7,m.sg,m.u,J.Nt,G.Ou,V.Ov],styles:[".eav-dialog-title-box[_ngcontent-%COMP%]{white-space:nowrap}.eav-dialog-title-box[_ngcontent-%COMP%]   .eav-file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.eav-field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.eav-field-container.eav-multiple[_ngcontent-%COMP%]{display:flex}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]{flex:1}.eav-field-container.eav-multiple[_ngcontent-%COMP%]   .eav-multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.eav-preview-label-box[_ngcontent-%COMP%]{position:relative}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0;font-size:12px;color:#0009;pointer-events:none}.eav-preview-label-box[_ngcontent-%COMP%]   .eav-preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.eav-preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]})}return o})();var it=a(2611),lt=a(7138),st=a(8497);let rt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#o=this.\u0275inj=t.cJS({providers:[it._,y.t,{provide:Z.o2,useValue:{subscriptSizing:"dynamic"}},{provide:L.PG,useValue:{hideSingleSelectionIndicator:!0}}],imports:[V.ez,lt.q,z.ot,L.LD,m.UX,Z.lN,J.c,G.Cq,st.QW]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.01.05/dist/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_index_ts.daad635de032791f.js.map