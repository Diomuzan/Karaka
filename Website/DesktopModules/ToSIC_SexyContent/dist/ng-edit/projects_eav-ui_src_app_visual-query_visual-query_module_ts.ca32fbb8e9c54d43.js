"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_visual-query_visual-query_module_ts"],{5653:(Ae,q,r)=>{r.r(q),r.d(q,{VisualQueryModule:()=>Ze});var g=r(6575),h=r(8849),v=r(895),_=r(6861),A=r(1268),S=r(6515),G=r(9674),N=r(6355),w=r(9293),F=r(9409),U=r(989),L=r(5530),H=r(7477),R=r(2611),X=r(7138),y=r(9736),Z=r(1217),m=r(196),t=r(9039),tt=r(4860),et=r(6232);let $=(()=>{class o{constructor(e,i,n){this.http=e,this.context=i,this.dnnContext=n}fetchPipeline(e,i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.TB),{params:{appId:this.context.appId.toString(),id:e.toString()}}).pipe((0,y.U)(n=>(n.DataSources.length||this.buildDefaultModel(n,i),this.fixPipelineDataSources(n.DataSources),n)))}buildDefaultModel(e,i){const n=m.Zy.pipelineDesigner.defaultPipeline.dataSources;for(const a of n){const l=i.find(u=>u.PartAssemblyAndType===a.PartAssemblyAndType);e.DataSources.push({Description:"",EntityGuid:a.EntityGuid,EntityId:void 0,Name:l.Name,PartAssemblyAndType:a.PartAssemblyAndType,VisualDesignerData:a.VisualDesignerData})}e.Pipeline.StreamWiring=m.Zy.pipelineDesigner.defaultPipeline.streamWiring}fixPipelineDataSources(e){if(!e.some(n=>n.EntityGuid===m.Zy.pipelineDesigner.outDataSource.EntityGuid)){const n=m.Zy.pipelineDesigner.outDataSource;e.push({Description:n.Description,EntityGuid:n.EntityGuid,EntityId:void 0,Name:n.Name,PartAssemblyAndType:n.PartAssemblyAndType,VisualDesignerData:n.VisualDesignerData})}for(const n of e)n.VisualDesignerData??={Top:50,Left:50}}fetchDataSources(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.bf),{params:{appid:this.context.appId,zoneId:this.context.zoneId}}).pipe((0,y.U)(e=>{const i=m.Zy.pipelineDesigner.outDataSource;return e.push({ContentType:void 0,Difficulty:m.Zy.pipelineDesigner.dataSourceDifficulties.default,DynamicIn:!0,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:i.In,Name:i.Name,Out:void 0,PartAssemblyAndType:i.PartAssemblyAndType,PrimaryType:i.PrimaryType,TypeNameForUi:void 0,UiHint:void 0}),e}))}typeNameFilter(e,i){const n=e.split(", ");switch(i){case"classFullName":return n[0];case"className":const l=n[0].split(".");return l[l.length-1];default:return e}}savePipeline(e){const i=e.Pipeline,n=e.DataSources;return this.http.post(this.dnnContext.$2sxc.http.apiUrl(Z.nt),{pipeline:i,dataSources:n},{params:{appId:this.context.appId.toString(),Id:i.EntityId.toString()}}).pipe((0,y.U)(a=>(this.fixPipelineDataSources(a.DataSources),a)))}runPipeline(e,i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.cv),{params:{appId:this.context.appId.toString(),id:e.toString(),top:i.toString()}})}debugStream(e,i,n,a){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(Z.Az),{params:{appId:this.context.appId.toString(),id:e.toString(),from:i,out:n,top:a.toString()}})}static#t=this.\u0275fac=function(i){return new(i||o)(t.LFG(tt.eN),t.LFG(R._),t.LFG(et._y))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac})}return o})();var b=r(91),J=r(2968),it=r(8226),M=r(8071),j=r(3317),k=r(3839),O=r(926),Y=r(9097),nt=r(1632),C=r(3704),ot=r(9877),at=r(9016),K=r(4520),st=r(6041),Q=r(2957),E=r(9498);function lt(o,s){if(1&o&&t._uU(0),2&o){const e=t.oxw();t.AsE(' for Stream: "',e.debugStream.name,'" on Source: "',e.debugStream.sourceName,'" ')}}function rt(o,s){1&o&&(t.TgZ(0,"div",10)(1,"span"),t._uU(2,"Results"),t.qZA()())}function ct(o,s){1&o&&t._uU(0," Showing All results ")}function ut(o,s){if(1&o&&t._uU(0),2&o){const e=t.oxw();t.hij(" Showing top ",e.top," results ")}}function dt(o,s){1&o&&t._uU(0," All ")}function pt(o,s){if(1&o&&t._uU(0),2&o){const e=t.oxw().$implicit;t.hij(" ",e," ")}}function mt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.show(a))}),t._uU(1," Show "),t.YNc(2,dt,1,0)(3,pt,1,1),t.qZA()}if(2&o){const e=s.$implicit;t.xp6(2),t.um2(2,0===e?2:-1),t.xp6(1),t.um2(3,0!==e?3:-1)}}function gt(o,s){1&o&&(t.TgZ(0,"div",13)(1,"span"),t._uU(2,"Parameters"),t.qZA()())}function ht(o,s){if(1&o&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.Oqu(e)}}function ft(o,s){if(1&o&&(t.TgZ(0,"mat-tab"),t.YNc(1,gt,3,0,"div",12),t._UZ(2,"br"),t.TgZ(3,"ul"),t.SjG(4,ht,2,1,"li",null,t.x6l),t.qZA()()),2&o){const e=t.oxw();t.xp6(4),t.wJu(e.parameters)}}function _t(o,s){1&o&&(t.TgZ(0,"div",14)(1,"span"),t._uU(2,"Sources"),t.qZA()())}function yt(o,s){if(1&o&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e.value.Definition?null:e.value.Definition.Name)}}function vt(o,s){if(1&o&&(t.TgZ(0,"li")(1,"b"),t._uU(2),t.qZA(),t._uU(3,"="),t.TgZ(4,"em"),t._uU(5),t.qZA()()),2&o){const e=s.$implicit;t.xp6(2),t.Oqu(e.key),t.xp6(3),t.Oqu(e.value)}}function Ct(o,s){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t.YNc(2,yt,2,1,"div"),t.TgZ(3,"pre"),t._uU(4),t.qZA()(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td")(8,"ol"),t.SjG(9,vt,6,2,"li",null,t.x6l),t.ALo(11,"keyvalue"),t.qZA()(),t.TgZ(12,"td"),t._uU(13),t.qZA()()),2&o){const e=s.$implicit;t.xp6(2),t.um2(2,null!=e.value.Definition&&e.value.Definition.Name?2:-1),t.xp6(2),t.Oqu(e.value.Guid),t.xp6(2),t.Oqu(e.value.Type),t.xp6(3),t.wJu(t.lcZ(11,4,e.value.Configuration)),t.xp6(4),t.Oqu(e.value.Error)}}function xt(o,s){1&o&&(t.TgZ(0,"div",15)(1,"span"),t._uU(2,"Streams"),t.qZA()())}function St(o,s){if(1&o&&(t.TgZ(0,"tr")(1,"td")(2,"pre"),t._uU(3),t.qZA()(),t.TgZ(4,"td")(5,"pre"),t._uU(6),t.qZA()(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA()()),2&o){const e=s.$implicit;t.xp6(3),t.Oqu(e.Source+":"+e.SourceOut),t.xp6(3),t.Oqu(e.Target+":"+e.TargetIn),t.xp6(2),t.Oqu(e.Count),t.xp6(2),t.Oqu(e.Error)}}let bt=(()=>{class o{constructor(e,i,n){this.dialogData=e,this.dialogRef=i,this.visualQueryService=n}ngOnInit(){const e=this.visualQueryService.pipelineModel$.value.Pipeline,i=(e.Params?.split("\n")??[]).filter(a=>!!a),n=(e.TestParameters?.split("\n")??[]).filter(a=>!!a);this.parameters=[].concat(i,n),this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.top=this.dialogData.top,this.optionsForTop=[25,100,1e3,0],this.result=this.dialogData.result.Query,this.debugStream=this.dialogData.debugStream,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams}closeDialog(){this.dialogRef.close()}show(e){e!==this.top&&(this.debugStream?this.visualQueryService.debugStream(this.debugStream.original,e):this.visualQueryService.runPipeline(e),this.closeDialog())}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(_.WI),t.Y36(_.so),t.Y36(D))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-query-result"]],decls:54,vars:11,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["dynamicHeight","","color","accent",1,"eav-tab-group"],["class","mat-tab-label-box","tippy","Results",4,"matTabLabel"],[1,"eav-tab-description"],["class","mat-tab-label-box","tippy","Sources",4,"matTabLabel"],["class","mat-tab-label-box","tippy","Streams",4,"matTabLabel"],["tippy","Results",1,"mat-tab-label-box"],["mat-button","",3,"click"],["class","mat-tab-label-box","tippy","Parameters",4,"matTabLabel"],["tippy","Parameters",1,"mat-tab-label-box"],["tippy","Sources",1,"mat-tab-label-box"],["tippy","Streams",1,"mat-tab-label-box"],["mat-button",""]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3," Query Results "),t.YNc(4,lt,1,2),t.qZA(),t.TgZ(5,"button",3),t.NdJ("click",function(){return n.closeDialog()}),t.TgZ(6,"mat-icon"),t._uU(7,"close"),t.qZA()()(),t.TgZ(8,"div",4)(9,"p"),t._uU(10),t.qZA(),t.TgZ(11,"mat-tab-group",5)(12,"mat-tab"),t.YNc(13,rt,3,0,"div",6),t.TgZ(14,"p",7),t.YNc(15,ct,1,0)(16,ut,1,1),t.SjG(17,mt,4,2,"button",16,t.x6l),t.qZA(),t.TgZ(19,"pre"),t._uU(20),t.ALo(21,"json"),t.qZA()(),t.YNc(22,ft,6,0,"mat-tab"),t.TgZ(23,"mat-tab"),t.YNc(24,_t,3,0,"div",8),t._UZ(25,"br"),t.TgZ(26,"table")(27,"tr")(28,"th"),t._uU(29,"Name and Guid"),t.qZA(),t.TgZ(30,"th"),t._uU(31,"Type"),t.qZA(),t.TgZ(32,"th"),t._uU(33,"Configuration"),t.qZA(),t.TgZ(34,"th"),t._uU(35,"Error"),t.qZA()(),t.SjG(36,Ct,14,6,"tr",null,t.x6l),t.ALo(38,"keyvalue"),t.qZA()(),t.TgZ(39,"mat-tab"),t.YNc(40,xt,3,0,"div",9),t._UZ(41,"br"),t.TgZ(42,"table")(43,"tr")(44,"th"),t._uU(45,"Source"),t.qZA(),t.TgZ(46,"th"),t._uU(47,"Target"),t.qZA(),t.TgZ(48,"th"),t._uU(49,"Items"),t.qZA(),t.TgZ(50,"th"),t._uU(51,"Error"),t.qZA()(),t.SjG(52,St,11,4,"tr",null,t.x6l),t.qZA()()()()()),2&i&&(t.xp6(4),t.um2(4,n.debugStream?4:-1),t.xp6(6),t.AsE(" The Full result was logged to the Browser Console. Further down you'll find more debug-infos. Executed in ",n.timeUsed,"ms (",n.ticksUsed," ticks) "),t.xp6(5),t.um2(15,0===n.top?15:-1),t.xp6(1),t.um2(16,0!==n.top?16:-1),t.xp6(1),t.wJu(n.optionsForTop),t.xp6(3),t.Oqu(t.lcZ(21,7,n.result)),t.xp6(2),t.um2(22,null!=n.parameters&&n.parameters.length?22:-1),t.xp6(14),t.wJu(t.lcZ(38,9,n.sources)),t.xp6(16),t.wJu(n.streams))},dependencies:[E.$,S.Hw,v.lW,v.RK,U.uD,U.uX,U.SP,g.Ts,g.Nd],styles:[".eav-tab-group[_ngcontent-%COMP%]{padding:0}.eav-tab-description[_ngcontent-%COMP%]{display:flex;align-items:baseline}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}td[_ngcontent-%COMP%]{vertical-align:baseline}"]})}return o})(),Tt=(()=>{class o{constructor(e,i){this.dialogData=e,this.dialogRef=i}ngOnInit(){this.errorData=this.dialogData.errorData}closeDialog(){this.dialogRef.close()}openInsights(){window.open(window.$2sxc.http.apiUrl("sys/insights/logs?key=web-api-query"),"_blank")}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(_.WI),t.Y36(_.so))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-stream-error-result"]],decls:17,vars:3,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["align","end"],["mat-button","","tippy","Open 2sxc Insights",1,"eav-button__with-icon",3,"click"],[1,"eav-icon"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Stream Error Results"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.closeDialog()}),t.TgZ(5,"mat-icon"),t._uU(6,"close"),t.qZA()()(),t.TgZ(7,"div",4)(8,"pre"),t._uU(9),t.ALo(10,"json"),t.qZA()(),t.TgZ(11,"mat-dialog-actions",5)(12,"button",6),t.NdJ("click",function(){return n.openInsights()}),t.TgZ(13,"mat-icon",7),t._uU(14,"speed"),t.qZA(),t.TgZ(15,"span"),t._uU(16,"Insights"),t.qZA()()()()),2&i&&(t.xp6(9),t.Oqu(t.lcZ(10,1,n.errorData)))},dependencies:[E.$,S.Hw,v.lW,v.RK,_.H8,g.Ts],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}.mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]})}return o})();var Dt=r(6480);let D=(()=>{class o extends st.H{constructor(e,i,n,a,l,c,u,d,f,T,P){super(e,i),this.router=e,this.route=i,this.queryDefinitionService=n,this.titleService=a,this.snackBar=l,this.dialog=c,this.viewContainerRef=u,this.zone=d,this.metadataService=f,this.contentTypesService=T,this.changeDetectorRef=P,this.pipelineModel$=new M.X(null),this.dataSources$=new M.X(null),this.putEntityCountOnConnections$=new ot.x,this.dataSourceConfigs$=new M.X({}),this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1}ngOnDestroy(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),super.ngOnDestroy()}init(){this.fetchDataSources(()=>this.fetchPipeline(!0,!0,!1)),this.attachKeyboardSave(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{(this.refreshPipeline||this.refreshDataSourceConfigs)&&this.fetchPipeline(this.refreshPipeline,this.refreshDataSourceConfigs,this.refreshPipeline),this.refreshPipeline=!1,this.refreshDataSourceConfigs=!1}))}editPipelineEntity(){this.savePipeline(()=>{const i=(0,Q.f)({items:[{EntityId:this.pipelineModel$.value.Pipeline.EntityId}]});this.router.navigate([`edit/${i}`],{relativeTo:this.route}),this.refreshPipeline=!0})}saveAndRun(e,i){e&&i?this.savePipeline(()=>{this.runPipeline()}):e?this.savePipeline():i&&this.runPipeline()}showDataSourceDetails(e){const i=(0,C.Z)(this.pipelineModel$.value),n=O.iX.tryParse(i.Pipeline.VisualDesignerData)??{};n.ShowDataSourceDetails=e,i.Pipeline.VisualDesignerData=JSON.stringify(n),this.pipelineModel$.next(i)}addDataSource(e){const i=(0,C.Z)(this.pipelineModel$.value);i.DataSources.push({Description:"",EntityGuid:"unsaved"+(i.DataSources.length+1),EntityId:void 0,Name:e.Name,PartAssemblyAndType:e.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}}),this.pipelineModel$.next(i),this.savePipeline()}removeDataSource(e,i,n){const a=(0,C.Z)(this.pipelineModel$.value);a.DataSources=a.DataSources.filter(l=>l.EntityGuid!==e),a.Pipeline.StreamWiring=i,a.Pipeline.StreamsOut=n,this.pipelineModel$.next(a)}renameDataSource(e,i){const n=(0,C.Z)(this.pipelineModel$.value);n.DataSources.find(l=>l.EntityGuid===e).Name=i,this.pipelineModel$.next(n)}changeDataSourceDescription(e,i){const n=(0,C.Z)(this.pipelineModel$.value);n.DataSources.find(l=>l.EntityGuid===e).Description=i,this.pipelineModel$.next(n)}changeConnections(e,i){const n=(0,C.Z)(this.pipelineModel$.value);n.Pipeline.StreamWiring=e,n.Pipeline.StreamsOut=i,this.pipelineModel$.next(n)}changeDataSourcePosition(e,i){const n=(0,C.Z)(this.pipelineModel$.value),a=n.DataSources.find(l=>l.EntityGuid===e);a&&(a.VisualDesignerData={...a.VisualDesignerData,...i},this.pipelineModel$.next(n))}calculateDataSourceConfigs(e){const i={};e.forEach(n=>{null!=n.EntityId&&(i[n.EntityId]=[],n.Metadata?.forEach(a=>{Object.entries(a).forEach(([l,c])=>{null==c||""===c||["Created","Guid","Id","Modified","Title","_Type"].includes(l)||(Array.isArray(c)&&null!=c[0]?.Title&&null!=c[0]?.Id&&(c=`${c[0].Title} (${c[0].Id})`),i[n.EntityId].push({name:l,value:c}))})}))}),this.dataSourceConfigs$.next(i)}editDataSource(e){const n=this.dataSources$.value.find(u=>u.PartAssemblyAndType===e.PartAssemblyAndType).ContentType,c=e.EntityGuid;this.metadataService.getMetadata(m.Zy.metadata.entity.targetType,m.Zy.metadata.entity.keyType,c,n).subscribe(u=>{if(u.Items.length){const f=(0,Q.f)({items:[{EntityId:u.Items[0].Id}]});return this.router.navigate([`edit/${f}`],{relativeTo:this.route}),void(this.refreshDataSourceConfigs=!0)}this.contentTypesService.retrieveContentType(n).subscribe({next:d=>{if(null==d)return void this.snackBar.open("DataSource doesn't have any configuration",void 0,{duration:3e3});const T=(0,Q.f)({items:[{ContentTypeName:n,For:{Target:m.Zy.metadata.entity.target,TargetType:m.Zy.metadata.entity.targetType,Guid:c}}]});this.router.navigate([`edit/${T}`],{relativeTo:this.route}),this.refreshDataSourceConfigs=!0},error:d=>{this.snackBar.open("Server reports error - this usually means that this DataSource doesn't have any configuration",void 0,{duration:3e3})}})})}savePipeline(e){this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:i=>{this.snackBar.open("Saved",null,{duration:2e3}),this.pipelineModel$.next(i),e?.()},error:i=>{this.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})}runPipeline(e=25){this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId,e).subscribe({next:i=>{this.snackBar.open("Query worked",null,{duration:2e3}),this.pipelineResult=i,this.showQueryResult(i,e),console.warn(i),this.pipelineModel$.next((0,C.Z)(this.pipelineModel$.value)),setTimeout(()=>{this.putEntityCountOnConnections$.next(i)})},error:i=>{this.snackBar.open("Query failed",null,{duration:2e3})}})}debugStream(e,i=25){e.Error?this.showStreamErrorResult(e):0!==e.Count&&(this.snackBar.open("Running stream..."),this.queryDefinitionService.debugStream(this.pipelineModel$.value.Pipeline.EntityId,e.Source,e.SourceOut,i).subscribe({next:a=>{this.snackBar.open("Stream worked",null,{duration:2e3});const l=this.pipelineModel$.value.DataSources.find(u=>u.EntityGuid===e.Source);this.showQueryResult(a,i,{name:e.SourceOut,source:e.Source,sourceName:l.Name,original:e}),console.warn(a)},error:a=>{this.snackBar.open("Stream failed",null,{duration:2e3})}}))}fetchPipeline(e,i,n){n&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId,this.dataSources$.value).subscribe(a=>{n&&this.snackBar.open("Query reloaded",null,{duration:2e3}),this.titleService.setTitle(`${a.Pipeline.Name} - Visual Query`),e&&this.pipelineModel$.next(a),i&&this.calculateDataSourceConfigs(a.DataSources)})}showQueryResult(e,i,n){this.dialog.open(bt,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{result:e,debugStream:n,top:i},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}showStreamErrorResult(e){this.dialog.open(Tt,{autoFocus:!1,backdropClass:"dialog-backdrop",closeOnNavigation:!1,data:{errorData:e.ErrorData},panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],position:{top:"0"},viewContainerRef:this.viewContainerRef}),this.changeDetectorRef.markForCheck()}fetchDataSources(e){this.queryDefinitionService.fetchDataSources().subscribe(i=>{this.dataSources$.next(i),e()})}attachKeyboardSave(){this.zone.runOutsideAngular(()=>{this.subscription.add((0,at.R)(window,"keydown").pipe((0,K.h)(()=>!this.route.snapshot.firstChild),(0,K.h)(e=>(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&83===e.keyCode)).subscribe(e=>{e.preventDefault(),this.zone.run(()=>{this.savePipeline()})}))})}static#t=this.\u0275fac=function(i){return new(i||o)(t.LFG(b.F0),t.LFG(b.gz),t.LFG($),t.LFG(Dt.Dx),t.LFG(F.ux),t.LFG(_.uw),t.LFG(t.s_b),t.LFG(t.R0b),t.LFG(H.D),t.LFG(L.s),t.LFG(t.sBO))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac})}return o})();const I={App:{Name:"App",Label:"App DataSources",Icon:"star",UiHint:"DataSources from the current App"},Cache:{Name:"Cache",Icon:"history",UiHint:"Caching of data"},Filter:{Name:"Filter",Icon:"filter_list",UiHint:"Filter data - usually returning less items than came in"},Logic:{Name:"Logic",Icon:"share",UiHint:"Logic operations - usually choosing between different streams"},Lookup:{Name:"Lookup",Icon:"search",UiHint:"Lookup operation - usually looking for other data based on a criteria"},Modify:{Name:"Modify",Icon:"edit_attributes",UiHint:"Modify data - usually changing, adding or removing values"},Security:{Name:"Security",Icon:"account_circle",UiHint:"Security - usually limit what the user sees based on his identity"},Sort:{Name:"Sort",Icon:"sort",UiHint:"Sort the items"},Source:{Name:"Source",Icon:"cloud_upload",UiHint:"Source of new data - usually SQL, CSV or similar"},Target:{Name:"Target",Icon:"adjust",UiHint:"Target - usually just a destination of data"},Unknown:{Name:"Unknown",Icon:"fiber_manual_record",UiHint:"Unknown type"},Debug:{Name:"Debug",Icon:"bug_report",UiHint:"Debugging Tools"},System:{Name:"System",Icon:"military_tech",UiHint:"System Data"}};function Zt(o,s){const e={};for(const i of o){let n;const a=s.find(l=>l.PartAssemblyAndType===i.PartAssemblyAndType);a&&(n={...a.PrimaryType?I[a.PrimaryType]:I.Unknown},null!=a.Icon&&(n.Icon=a.Icon),null!=a.DynamicIn&&(n.DynamicIn=a.DynamicIn),null!=a.DynamicOut&&(n.DynamicOut=a.DynamicOut),null!=a.HelpLink&&(n.HelpLink=a.HelpLink),null!=a.EnableConfig&&(n.EnableConfig=a.EnableConfig),null!=a.UiHint&&(n.UiHint=a.UiHint)),n||(n={...I.Unknown}),e[i.EntityGuid]=n}return e}var Et=r(5043),Pt=r(9851),At=r(131),wt=r(257);function Mt(o,s){1&o&&(t.TgZ(0,"app-field-hint"),t._uU(1," You will get suggestions for out-streams after you run query "),t.qZA())}function Ot(o,s){1&o&&(t.TgZ(0,"app-field-hint",12),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}function Ut(o,s){if(1&o&&(t.TgZ(0,"mat-form-field",10)(1,"mat-label"),t._uU(2,"Label"),t.qZA(),t._UZ(3,"input",11),t.qZA(),t.YNc(4,Mt,2,0,"app-field-hint")(5,Ot,2,1,"app-field-hint",12)),2&o){const e=t.oxw();t.xp6(4),t.um2(4,e.isSource&&!e.pipelineResultExists?4:-1),t.xp6(1),t.um2(5,e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?5:-1)}}function Rt(o,s){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function kt(o,s){if(1&o&&(t.TgZ(0,"mat-form-field",10)(1,"mat-label"),t._uU(2,"Scope"),t.qZA(),t.TgZ(3,"mat-select",18),t.SjG(4,Rt,2,2,"mat-option",20,t.x6l),t.qZA()(),t.TgZ(6,"app-field-hint"),t._uU(7," The scope should almost never be changed - "),t.TgZ(8,"a",19),t._uU(9,"see help"),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(3),t.Q6J("placeholder",e.scopeOptions.length?"":"No items found"),t.xp6(1),t.wJu(e.scopeOptions)}}function It(o,s){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function Nt(o,s){if(1&o&&(t.TgZ(0,"mat-select",13),t.SjG(1,It,2,2,"mat-option",20,t.x6l),t.qZA()),2&o){const e=t.oxw(2);t.Q6J("placeholder",e.labelOptions.length?"":"No items found"),t.xp6(1),t.wJu(e.labelOptions)}}function $t(o,s){1&o&&t._UZ(0,"input",11)}function Qt(o,s){1&o&&(t.TgZ(0,"app-field-hint",12),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}const V=o=>({active:o});function qt(o,s){if(1&o){const e=t.EpF();t.YNc(0,kt,10,1),t.TgZ(1,"mat-form-field",10)(2,"mat-label"),t._uU(3,"Label"),t.qZA(),t.YNc(4,Nt,3,1,"mat-select",13)(5,$t,1,0,"input",11),t.TgZ(6,"div",14)(7,"button",15),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.toggleGuidedLabel(!0))}),t.TgZ(8,"mat-icon",16),t._uU(9,"search"),t.qZA()(),t.TgZ(10,"button",17),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.toggleGuidedLabel(!1))}),t.TgZ(11,"mat-icon",16),t._uU(12,"text_fields"),t.qZA()()()(),t.YNc(13,Qt,2,1,"app-field-hint",12)}if(2&o){const e=t.oxw();t.um2(0,e.advancedMode&&e.guidedLabel?0:-1),t.xp6(4),t.um2(4,e.guidedLabel?4:-1),t.xp6(1),t.um2(5,e.guidedLabel?-1:5),t.xp6(2),t.Q6J("ngClass",t.VKq(6,V,e.guidedLabel)),t.xp6(3),t.Q6J("ngClass",t.VKq(8,V,!e.guidedLabel)),t.xp6(3),t.um2(13,e.controls.label.touched&&null!=e.controls.label.errors&&e.controls.label.errors.required?13:-1)}}function Gt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"mat-slide-toggle",21),t.NdJ("change",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleAdvancedMode(n))}),t._uU(1),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("checked",e.advancedMode),t.xp6(1),t.hij(" ",e.advancedMode?"Advanced":"Simple"," ")}}let Ft=(()=>{class o extends Y.f{constructor(e,i,n,a,l){super(),this.dialogData=e,this.dialogRef=i,this.visualQueryService=n,this.contentTypesService=a,this.changeDetectorRef=l,this.hostClass="dialog-component",this.isSource=this.dialogData.isSource,this.pipelineResultExists=null!=this.visualQueryService.pipelineResult,this.scopeOptions=[],this.labelOptions=[],this.guidedLabel=!0,this.advancedMode=!1}ngOnInit(){this.buildForm()}ngOnDestroy(){super.ngOnDestroy()}closeDialog(e){this.dialogRef.close(e)}toggleGuidedLabel(e){this.guidedLabel=e}toggleAdvancedMode(e){this.advancedMode=e.checked}rename(){const e=this.form.getRawValue();this.closeDialog(e.label)}buildForm(){this.form=new h.nJ({label:new h.p4(this.dialogData.label,h.kI.required),scope:new h.p4(m.Zy.scopes.default.value)}),this.controls=this.form.controls,this.isSource&&this.pipelineResultExists&&(this.subscription.add(this.controls.scope.valueChanges.pipe((0,Et.O)(this.controls.scope.value),(0,j.x)()).subscribe(e=>{this.labelOptions=Object.values(this.visualQueryService.pipelineResult.Sources).find(i=>i.Guid===this.dialogData.pipelineDataSourceGuid).Out.filter(i=>i.Scope===e).map(i=>i.Name),!this.labelOptions.includes(this.controls.label.value)&&null!=this.controls.label.value&&this.controls.label.patchValue(null)})),this.contentTypesService.getScopes().subscribe(e=>{const i=Object.values(this.visualQueryService.pipelineResult.Sources).find(a=>a.Guid===this.dialogData.pipelineDataSourceGuid).Out,n=e.filter(a=>i.some(l=>l.Scope===a.value));this.scopeOptions=n,this.changeDetectorRef.markForCheck()}))}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(_.WI),t.Y36(_.so),t.Y36(D),t.Y36(Z.sF),t.Y36(t.sBO))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-rename-stream"]],hostVars:1,hostBindings:function(i,n){2&i&&t.Ikx("className",n.hostClass)},features:[t.qOj],decls:19,vars:5,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"formGroup"],[1,"eav-dialog-actions"],["color","accent",3,"checked"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["color","accent",1,"eav-form-field"],["matInput","","type","text","formControlName","label","required",""],[3,"isError"],["formControlName","label","required","",3,"placeholder"],["matTextSuffix","",1,"eav-selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",1,"eav-selection-suffix-button",3,"ngClass","click"],[1,"eav-icon"],["mat-icon-button","","type","button","tippy","Manual entry",1,"eav-selection-suffix-button",3,"ngClass","click"],["formControlName","scope",3,"placeholder"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],[3,"value"],["color","accent",3,"checked","change"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Rename stream"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.closeDialog()}),t.TgZ(5,"mat-icon"),t._uU(6,"close"),t.qZA()()(),t.TgZ(7,"div",4)(8,"form",5),t.YNc(9,Ut,6,2)(10,qt,14,10),t.qZA()(),t.TgZ(11,"mat-dialog-actions",6)(12,"div"),t.YNc(13,Gt,2,2,"mat-slide-toggle",7),t.qZA(),t.TgZ(14,"div")(15,"button",8),t.NdJ("click",function(){return n.closeDialog()}),t._uU(16,"Cancel"),t.qZA(),t.TgZ(17,"button",9),t.NdJ("click",function(){return n.rename()}),t._uU(18," Rename "),t.qZA()()()()),2&i&&(t.xp6(8),t.Q6J("formGroup",n.form),t.xp6(1),t.um2(9,n.isSource&&n.pipelineResultExists?-1:9),t.xp6(1),t.um2(10,n.isSource&&n.pipelineResultExists?10:-1),t.xp6(3),t.um2(13,n.isSource&&n.pipelineResultExists?13:-1),t.xp6(4),t.Q6J("disabled",!n.form.valid))},dependencies:[g.mk,Pt.Y,At.E,E.$,S.Hw,v.lW,v.RK,w.Rr,_.H8,A.KE,A.hX,A.R9,h._Y,h.Fj,h.JJ,h.JL,h.Q7,h.sg,h.u,N.gD,wt.ey,G.Nt]})}return o})();const p="dataSource_";class Lt{constructor(s,e,i,n,a,l,c,u,d){this.jsPlumbRoot=s,this.pipelineModel=e,this.dataSources=i,this.onConnectionsChanged=n,this.onDragend=a,this.onDebugStream=l,this.dialog=c,this.viewContainerRef=u,this.changeDetectorRef=d,this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=window.jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch(()=>{this.initDomDataSources(),this.initWirings(),this.bindEvents()}),this.instance.repaintEverything()}destroy(){this.dialogRef?.close(),this.instance.reset(),this.instance.unbindContainer()}removeEndpointsOnDataSource(s){const e=p+s;this.bulkDelete=!0,this.instance.batch(()=>{this.instance.selectEndpoints({element:e}).delete()}),this.bulkDelete=!1}getAllConnections(){return this.instance.getAllConnections().map(e=>({From:e.sourceId.replace(p,""),Out:e.endpoints[0].getOverlay("endpointLabel").label,To:e.targetId.replace(p,""),In:e.endpoints[1].getOverlay("endpointLabel").label}))}getStreamsOut(){const s=[];return this.instance.selectEndpoints({target:p+"Out"}).each(i=>{s.push(i.getOverlay("endpointLabel").label)}),s.join(",")}putEntityCountOnConnections(s){s.Streams?.forEach(e=>{const i=p+e.Source,a=["00000000-0000-0000-0000-000000000000",this.pipelineModel.Pipeline.EntityGuid].includes(e.Target)?p+"Out":p+e.Target,l=i+"_out_"+e.SourceOut,c=a+"_in_"+e.TargetIn;this.instance.getEndpoint(l)?.connections?.filter(d=>d.endpoints[1].getUuid()===c)?.forEach(d=>{const f=e.Error?"":e.Count.toString();d.setLabel({label:f,cssClass:"streamEntitiesCount "+(e.Error?"streamEntitiesError":""),events:{click:P=>{this.pipelineModel.Pipeline.AllowEdit&&this.onDebugStream(e)}}})})})}nextLinePaintStyle(s){return this.uuidColorMap[s]||(this.uuidColorMap[s]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))}getInstanceDefaults(s){return{Container:s,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}}initDomDataSources(){for(const s of this.pipelineModel.DataSources){const e=this.jsPlumbRoot.querySelector("#"+p+s.EntityGuid);if(!e)continue;const i=this.dataSources.find(n=>n.PartAssemblyAndType===s.PartAssemblyAndType);if(i){if(this.pipelineModel.Pipeline.AllowEdit&&this.instance.draggable(e,{grid:[20,20],stop:n=>{const l=n.el.id.replace(p,""),c={Top:n.finalPos[1],Left:n.finalPos[0]};setTimeout(()=>{this.onDragend(l,c)})}}),i.Out?.forEach(n=>{this.addEndpoint(e,n,!1,s)}),i.In?.forEach(n=>{this.addEndpoint(e,n,!0,s)}),i.In){const n=this.buildTargetEndpoint(s.EntityGuid);n.maxConnections=-1,this.instance.makeTarget(e,n)}i.DynamicOut&&this.instance.makeSource(e,this.buildSourceEndpoint(s.EntityGuid),{filter:".add-endpoint"})}}}initWirings(){this.pipelineModel.Pipeline.StreamWiring?.forEach(s=>{const e=p+s.From,i=e+"_out_"+s.Out,n=p+s.To,a=n+"_in_"+s.In;if(!this.instance.getEndpoint(i)){const l=this.jsPlumbRoot.querySelector("#"+e);if(!l)return;const c=l.id.replace(p,""),u=this.pipelineModel.DataSources.find(d=>d.EntityGuid===c);this.addEndpoint(l,s.Out,!1,u)}if(!this.instance.getEndpoint(a)){const l=this.jsPlumbRoot.querySelector("#"+n);if(!l)return;const c=l.id.replace(p,""),u=this.pipelineModel.DataSources.find(d=>d.EntityGuid===c);this.addEndpoint(l,s.In,!0,u)}try{this.instance.connect({uuids:[i,a],paintStyle:this.nextLinePaintStyle(i)})}catch{console.error({message:"Connection failed",from:i,to:a})}})}addEndpoint(s,e,i,n){const a=this.dataSources.find(x=>x.PartAssemblyAndType===n.PartAssemblyAndType),l=i?!a.In?.some(x=>this.getEndpointInfo(x,!1)):!a.Out?.some(x=>this.getEndpointInfo(x,!1)),c=this.getEndpointInfo(e,l);let u;u=l?"dynamic":c.required?this.pipelineModel.Pipeline.StreamWiring?.some(W=>p+W.To===s.id&&W.In===c.name)?"":"required":"";const d=s.id+(i?"_in_":"_out_")+c.name,f=i?this.buildTargetEndpoint(n.EntityGuid,u):this.buildSourceEndpoint(n.EntityGuid,u);this.instance.addEndpoint(s,f,{uuid:d,enabled:this.pipelineModel.Pipeline.AllowEdit||n.EntityGuid===m.Zy.pipelineDesigner.outDataSource.EntityGuid}).getOverlay("endpointLabel").setLabel(c.name)}buildSourceEndpoint(s,e){return{paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint "+e,maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(!0),events:{click:a=>{this.onChangeLabel(a,!0,s)}}}}buildTargetEndpoint(s,e){return{paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint "+e,maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"},events:{click:a=>{this.onChangeLabel(a,!1,s)}}}}getEndpointOverlays(s){return[["Label",{id:"endpointLabel",location:[.5,s?0:1],label:"Default",cssClass:s?"endpointSourceLabel":"endpointTargetLabel"}]]}onChangeLabel(s,e,i){if(!this.pipelineModel.Pipeline.AllowEdit)return;const n=s.getOverlay?s.getOverlay("endpointLabel"):s;this.dialogRef=this.dialog.open(Ft,{autoFocus:!1,data:{pipelineDataSourceGuid:i,isSource:e,label:n.label},viewContainerRef:this.viewContainerRef,width:"650px"}),this.dialogRef.afterClosed().subscribe(l=>{l&&(n.setLabel(l),setTimeout(()=>{this.onConnectionsChanged()}))}),this.changeDetectorRef.markForCheck()}bindEvents(){this.instance.bind("connectionDetached",s=>{if(this.bulkDelete)return;const e=s.target,i=this.pipelineModel.DataSources.find(c=>c.EntityGuid===e.id.replace(p,"")),n=this.dataSources.find(c=>c.PartAssemblyAndType===i.PartAssemblyAndType),a=s.targetEndpoint.getOverlay("endpointLabel").label;n.In.some(c=>this.getEndpointInfo(c,!1).name===a)||this.instance.deleteEndpoint(s.targetEndpoint),setTimeout(()=>{this.onConnectionsChanged()})}),this.instance.bind("connection",s=>{if(s.sourceId===s.targetId)return void setTimeout(()=>{this.instance.deleteConnection(s.connection,{fireEvent:!1}),setTimeout(()=>{this.onConnectionsChanged()})});const e=s.targetEndpoint.getOverlay("endpointLabel"),i=e.getLabel();this.instance.getEndpoints(s.target.id).some(l=>l.getOverlay("endpointLabel").getLabel()===i&&s.targetEndpoint.id!==l.id&&l.canvas.classList.contains("targetEndpoint"))&&e.setLabel(`PleaseRename${Math.floor(99999*Math.random())}`),setTimeout(()=>{this.onConnectionsChanged()})})}getEndpointInfo(s,e){let i,n;if(e)i=s,n=!1;else{const l=s.trim();n=l.endsWith("*"),i=n?l.substring(0,l.length-1):l}return{name:i,required:n}}}var Ht=r(5941);const Jt=["domRoot"],jt=["domDataSource"];function Yt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"mat-icon",16),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,a=t.oxw(3);return t.KtG(a.configureDataSource(n))}),t._uU(1," settings "),t.qZA()}}function Kt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"mat-icon",17),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,a=t.oxw(2),l=t.oxw();return t.KtG(l.openHelp(a.typeInfos[n.EntityGuid].HelpLink))}),t._uU(1," help_outline "),t.qZA()}}function Vt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"mat-icon",18),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,a=t.oxw(3);return t.KtG(a.remove(n))}),t._uU(1," delete "),t.qZA()}}function Bt(o,s){if(1&o&&(t.TgZ(0,"tr",21)(1,"td",22),t._uU(2),t.qZA(),t.TgZ(3,"td",23),t._uU(4),t.qZA()()),2&o){const e=s.$implicit;t.xp6(1),t.Q6J("title",e.name),t.xp6(1),t.Oqu(e.name),t.xp6(1),t.Q6J("title",e.value),t.xp6(1),t.Oqu(e.value)}}function zt(o,s){if(1&o&&(t._UZ(0,"hr",19),t.TgZ(1,"table",20),t.SjG(2,Bt,5,4,"tr",24,t.x6l),t.qZA()),2&o){const e=t.oxw().$implicit,i=t.oxw(2);t.xp6(2),t.wJu(i.dataSourceConfigs[e.EntityId])}}function Wt(o,s){1&o&&t._UZ(0,"div",25)}function Xt(o,s){1&o&&t._UZ(0,"div",26)}const te=(o,s,e)=>({top:o,left:s,"min-width":e}),ee=o=>({"show-details":o});function ie(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",2,3)(2,"div",4)(3,"mat-icon",5),t._uU(4),t.qZA(),t.YNc(5,Yt,2,0,"mat-icon",6)(6,Kt,2,0,"mat-icon",7),t.qZA(),t.TgZ(7,"div",8),t.YNc(8,Vt,2,0,"mat-icon",9),t.qZA(),t.TgZ(9,"div",10),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw(2),c=t.oxw();return t.KtG(l.allowEdit&&c.editName(a))}),t.TgZ(10,"span"),t._uU(11),t.qZA(),t.TgZ(12,"mat-icon",11),t._uU(13,"edit"),t.qZA()(),t._UZ(14,"br"),t.TgZ(15,"div",12),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw(2),c=t.oxw();return t.KtG(l.allowEdit&&c.editDescription(a))}),t.TgZ(16,"span"),t._uU(17),t.qZA(),t.TgZ(18,"mat-icon",11),t._uU(19,"edit"),t.qZA()(),t._UZ(20,"br"),t.YNc(21,zt,4,0),t.TgZ(22,"div",13),t._uU(23),t.qZA(),t.YNc(24,Wt,1,0,"div",14)(25,Xt,1,0,"div",15),t.qZA()}if(2&o){const e=s.$implicit,i=t.oxw(2),n=t.oxw();t.Q6J("id",n.dataSrcIdPrefix+e.EntityGuid)("ngStyle",t.kEZ(15,te,e.VisualDesignerData.Top+"px",e.VisualDesignerData.Left+"px",e.VisualDesignerData.Width?e.VisualDesignerData.Width+"px":null))("ngClass",t.VKq(19,ee,i.showDataSourceDetails&&(null==i.dataSourceConfigs[e.EntityId]?null:i.dataSourceConfigs[e.EntityId].length))),t.xp6(3),t.Q6J("title",i.typeInfos[e.EntityGuid].UiHint),t.xp6(1),t.hij(" ",i.typeInfos[e.EntityGuid].Icon," "),t.xp6(1),t.um2(5,i.allowEdit&&i.typeInfos[e.EntityGuid].EnableConfig?5:-1),t.xp6(1),t.um2(6,i.typeInfos[e.EntityGuid].HelpLink?6:-1),t.xp6(2),t.um2(8,i.allowEdit&&!n.isOutDataSource(e)?8:-1),t.xp6(3),t.Oqu(e.Name||"(no name)"),t.xp6(6),t.Oqu(e.Description),t.xp6(4),t.um2(21,i.showDataSourceDetails&&null!=i.dataSourceConfigs[e.EntityId]&&i.dataSourceConfigs[e.EntityId].length?21:-1),t.xp6(1),t.Q6J("title",e.PartAssemblyAndType),t.xp6(1),t.hij(" Type: ",n.getTypeName(e.PartAssemblyAndType)," "),t.xp6(1),t.um2(24,i.allowEdit&&i.typeInfos[e.EntityGuid].DynamicOut?24:-1),t.xp6(1),t.um2(25,i.allowEdit&&i.typeInfos[e.EntityGuid].DynamicIn?25:-1)}}function ne(o,s){if(1&o&&t.SjG(0,ie,26,21,"div",27,t.x6l),2&o){const e=t.oxw();t.wJu(e.pipelineDataSources)}}function oe(o,s){if(1&o&&(t.TgZ(0,"div",0,1),t.YNc(2,ne,2,0),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.um2(2,e.hardReset?-1:2)}}let B=(()=>{class o extends Y.f{constructor(e,i,n,a,l){super(),this.visualQueryService=e,this.queryDefinitionService=i,this.changeDetectorRef=n,this.dialog=a,this.viewContainerRef=l,this.dataSrcIdPrefix=p,this.hardReset=!1,this.scriptLoaded$=new M.X(!1)}ngOnInit(){(0,nt.y)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],()=>{this.scriptLoaded$.next(!0)}),this.subscription.add(this.visualQueryService.putEntityCountOnConnections$.subscribe(i=>{this.plumber.putEntityCountOnConnections(i)}));const e=this.visualQueryService.pipelineModel$.pipe((0,y.U)(i=>O.iX.tryParse(i?.Pipeline.VisualDesignerData)??{}),(0,j.x)(O.iX.objectsEqual));this.viewModel$=(0,k.a)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$,e,this.visualQueryService.dataSourceConfigs$]).pipe((0,y.U)(([i,n,a,l])=>null==i||null==n?void 0:(this.hardReset=!0,this.changeDetectorRef.detectChanges(),this.hardReset=!1,{pipelineDataSources:i.DataSources,typeInfos:Zt(i.DataSources,n),allowEdit:i.Pipeline.AllowEdit,showDataSourceDetails:a.ShowDataSourceDetails??!1,dataSourceConfigs:l})))}ngAfterViewInit(){const e=this.domDataSourcesRef.changes.pipe((0,y.U)(()=>!0));this.subscription.add((0,k.a)([this.scriptLoaded$,e]).subscribe(([i,n])=>{!i||!n||(this.plumber?.destroy(),this.plumber=new Lt(this.domRootRef.nativeElement,this.visualQueryService.pipelineModel$.value,this.visualQueryService.dataSources$.value,this.onConnectionsChanged.bind(this),this.onDragend.bind(this),this.onDebugStream.bind(this),this.dialog,this.viewContainerRef,this.changeDetectorRef))}))}ngOnDestroy(){this.plumber?.destroy(),this.scriptLoaded$.complete(),super.ngOnDestroy()}onConnectionsChanged(){const e=this.plumber.getAllConnections(),i=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(e,i)}onDragend(e,i){this.visualQueryService.changeDataSourcePosition(e,i)}onDebugStream(e){this.visualQueryService.debugStream(e)}configureDataSource(e){e.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(e)}getTypeName(e){const i=this.visualQueryService.dataSources$.value.find(n=>n.PartAssemblyAndType===e);return this.queryDefinitionService.typeNameFilter(i?.TypeNameForUi||e,"className")}isOutDataSource(e){return e.PartAssemblyAndType===m.Zy.pipelineDesigner.outDataSource.PartAssemblyAndType}remove(e){if(!confirm(`Delete ${e.Name} data source?`))return;this.plumber.removeEndpointsOnDataSource(e.EntityGuid);const i=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(e.EntityGuid,i,n)}openHelp(e){window.open(e,"_blank")}editName(e){const i=prompt("Rename data source",e.Name)?.trim();null==i||""===i||this.visualQueryService.renameDataSource(e.EntityGuid,i)}editDescription(e){const i=prompt("Edit description",e.Description)?.trim();null!=i&&this.visualQueryService.changeDataSourceDescription(e.EntityGuid,i)}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(D),t.Y36($),t.Y36(t.sBO),t.Y36(_.uw),t.Y36(t.s_b))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-plumb-editor"]],viewQuery:function(i,n){if(1&i&&(t.Gf(Jt,5),t.Gf(jt,5)),2&i){let a;t.iGM(a=t.CRH())&&(n.domRootRef=a.first),t.iGM(a=t.CRH())&&(n.domDataSourcesRef=a)}},features:[t.qOj],decls:2,vars:3,consts:[["id","pipeline-root"],["domRoot",""],[1,"dataSource",3,"id","ngStyle","ngClass"],["domDataSource",""],[1,"actions","left"],[1,"type-info",3,"title"],["class","configure","title","Configure data source","appMousedownStopPropagation",""],["class","help","title","Help for this data source","appMousedownStopPropagation",""],[1,"actions","right"],["class","delete","title","Delete","appMousedownStopPropagation",""],["title","Click to edit name","appMousedownStopPropagation","",1,"name",3,"click"],[1,"show-hover-inline"],["title","Click to edit description","appMousedownStopPropagation","",1,"description",3,"click"],[1,"typename",3,"title"],["class","add-endpoint sourceEndpoint dynamic","title","Drag a new Out-Connection"],["class","many-in targetEndpoint dynamic","title","This data source supports multiple In-Connections"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],["title","Help for this data source","appMousedownStopPropagation","",1,"help",3,"click"],["title","Delete","appMousedownStopPropagation","",1,"delete",3,"click"],[2,"margin","0"],[1,"configs"],[1,"config"],[1,"config-name",3,"title"],[1,"config-value",3,"title"],["class","config"],["title","Drag a new Out-Connection",1,"add-endpoint","sourceEndpoint","dynamic"],["title","This data source supports multiple In-Connections",1,"many-in","targetEndpoint","dynamic"],["class","dataSource",3,"id","ngStyle","ngClass"]],template:function(i,n){if(1&i&&(t.YNc(0,oe,3,1,"div",0),t.ALo(1,"async")),2&i){let a;t.um2(0,(a=t.lcZ(1,1,n.viewModel$))?0:-1,a)}},dependencies:[g.mk,g.PC,Ht.d,S.Hw,g.Ov],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}\n\n/*# sourceMappingURL=https://sources.2sxc.org/17.01.02/dist/ng-edit/C:/Projects/2sxc/eav-ui/projects/eav-ui/src/app/visual-query/plumb-editor/plumb-editor.component.ts-angular-inline--1.css.map*/"]})}return o})();function le(o,s){if(1&o&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e," ")}}function re(o,s){if(1&o&&(t.TgZ(0,"ul",14),t.SjG(1,le,2,1,"li",null,t.x6l),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.wJu(null==e.Pipeline.Params?null:e.Pipeline.Params.split("\n"))}}function ce(o,s){if(1&o&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.xp6(1),t.hij(" ",e," ")}}function ue(o,s){if(1&o&&(t.TgZ(0,"ul",14),t.SjG(1,ce,2,1,"li",null,t.x6l),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.wJu(null==e.Pipeline.TestParameters?null:e.Pipeline.TestParameters.split("\n"))}}function de(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",6)(1,"span",15),t._uU(2,"Show DataSource Params"),t.qZA(),t.TgZ(3,"mat-slide-toggle",16),t.NdJ("change",function(n){t.CHM(e);const a=t.oxw(2);return t.KtG(a.showDataSourceDetails(n))}),t.qZA()()}2&o&&(t.xp6(3),t.Q6J("checked",s.ShowDataSourceDetails))}function pe(o,s){1&o&&t._UZ(0,"li",20),2&o&&t.Q6J("innerHTML",s.$implicit,t.oJD)}function me(o,s){if(1&o&&(t.TgZ(0,"div",18)(1,"div",7)(2,"span"),t._uU(3,"Warnings"),t.qZA(),t.TgZ(4,"mat-icon",19),t._uU(5,"warning"),t.qZA()(),t.TgZ(6,"ol",14),t.SjG(7,pe,1,1,"li",20,t.x6l),t.qZA()()),2&o){const e=t.oxw();t.xp6(7),t.wJu(e)}}function ge(o,s){1&o&&t.YNc(0,me,9,0,"div",17),2&o&&t.um2(0,s.length?0:-1)}function he(o,s){if(1&o&&(t.TgZ(0,"div",21)(1,"div",7),t._uU(2,"Query Description"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&o){const e=t.oxw();t.xp6(4),t.Oqu(e.Pipeline.Description)}}function fe(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.saveAndRunQuery(!0,!0))}),t._uU(4," Save and run "),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.saveAndRunQuery(!1,!0))}),t._uU(6," Run "),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.saveAndRunQuery(!0,!1))}),t._uU(8," Save "),t.qZA()(),t.TgZ(9,"div",6)(10,"div",7)(11,"div"),t._uU(12,"Query Parameters"),t.qZA(),t.TgZ(13,"div")(14,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.editPipeline())}),t.TgZ(15,"mat-icon"),t._uU(16,"edit"),t.qZA()(),t.TgZ(17,"button",9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.openParamsHelp())}),t.TgZ(18,"mat-icon"),t._uU(19,"info"),t.qZA()()()(),t.YNc(20,re,3,0,"ul",10),t.qZA(),t.TgZ(21,"div",6)(22,"div",7),t._uU(23,"Test Parameters"),t.qZA(),t.YNc(24,ue,3,0,"ul",10),t.qZA(),t.YNc(25,de,4,1,"div",11),t.ALo(26,"async"),t.YNc(27,ge,1,1),t.ALo(28,"async"),t.YNc(29,he,5,1,"div",12),t.TgZ(30,"div",13)(31,"button",5),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.openRestApi())}),t.TgZ(32,"span"),t._uU(33,"Use in JSON / REST API"),t.qZA(),t.TgZ(34,"mat-icon"),t._uU(35,"code_curly"),t.qZA()()()()()}if(2&o){const e=t.oxw();let i;t.xp6(20),t.um2(20,null!=s.Pipeline.Params&&s.Pipeline.Params.length?20:-1),t.xp6(4),t.um2(24,null!=s.Pipeline.TestParameters&&s.Pipeline.TestParameters.length?24:-1),t.xp6(1),t.um2(25,(i=t.lcZ(26,5,e.visualDesignerData$))?25:-1,i),t.xp6(2),t.um2(27,(i=t.lcZ(28,7,e.warnings$))?27:-1,i),t.xp6(2),t.um2(29,s.Pipeline.Description?29:-1)}}let _e=(()=>{class o{constructor(e,i,n,a){this.router=e,this.route=i,this.context=n,this.visualQueryService=a}ngOnInit(){this.pipelineModel$=this.visualQueryService.pipelineModel$.asObservable(),this.warnings$=this.visualQueryService.pipelineModel$.pipe((0,y.U)(e=>function se(o,s){const e=[];try{const i=o.Pipeline.Params?.split(/\r?\n/)||[],n=o.Pipeline.TestParameters?.split(/\r?\n/)||[];i.forEach(a=>{a=a?.trim(),a&&(/^[a-zA-Z0-9]+=(.*)$/gim.test(a)||e.push(`\n          A <em>Query Parameter</em> seems wrong: <br>\n          <code>${a}</code> <br>\n          It should use the syntax: <br>\n          <code>key=value</code> <br>\n          or resolve to a token like: <br>\n          <code>key=[source:key]</code>\n        `))}),n.forEach(a=>{if(a=a?.trim(),!a)return;/^\[[a-zA-Z]+:[a-zA-Z0-9]+\]=(.*)$/gim.test(a)||e.push(`\n          A <em>Test Parameter</em> seems wrong: <br>\n          <code>${a}</code> <br>\n          It should use the syntax: <br>\n          <code>[source:key]=value</code>\n        `);const d=/^\[module:id\]=([0-9]*)$/gim.exec(a);if(d){const P=d[1],x=s.moduleId?.toString();P!==x&&e.push(`\n            Your test ModuleId (${P}) is different from the current ModuleId (${x}).<br>\n            Note that 2sxc automatically provides the ModuleId - so you usually do not need to set it\n          `)}/^\[module:moduleid\]=([0-9]*)$/gim.exec(a)&&e.push("\n          You are using deprecated [Module:ModuleId] test parameter.<br>\n          Please use [Module:Id]\n        ")})}catch(i){console.error("Something went wrong in calculateWarnings for params",i)}return e}(e,this.context))),this.visualDesignerData$=this.visualQueryService.pipelineModel$.pipe((0,y.U)(e=>O.iX.tryParse(e.Pipeline.VisualDesignerData)??{}))}editPipeline(){this.visualQueryService.editPipelineEntity()}openParamsHelp(){window.open("https://go.2sxc.org/QueryParams","_blank")}saveAndRunQuery(e,i){this.visualQueryService.saveAndRun(e,i)}showDataSourceDetails(e){this.visualQueryService.showDataSourceDetails(e.checked)}openRestApi(){this.router.navigate([J.ii.getUrlQuery(this.visualQueryService.pipelineModel$.value.Pipeline.EntityGuid)],{relativeTo:this.route})}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(b.F0),t.Y36(b.gz),t.Y36(R._),t.Y36(D))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-run-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","tippy","Edit parameters",3,"click"],["mat-icon-button","","tippy","Query Params Docs",3,"click"],["class","values"],["class","parameters"],["class","description"],[1,"footer-actions"],[1,"values"],[1,"eav-slide-toggle-label"],["color","primary",3,"checked","change"],["class","warnings"],[1,"warnings"],[2,"color","red"],[3,"innerHTML"],[1,"description"]],template:function(i,n){if(1&i&&(t.YNc(0,fe,36,9,"div",0),t.ALo(1,"async")),2&i){let a;t.um2(0,(a=t.lcZ(1,1,n.pipelineModel$))?0:-1,a)}},dependencies:[E.$,S.Hw,v.lW,v.RK,w.Rr,g.Ov],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%], .footer-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type), .footer-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{margin:16px 0}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}.eav-slide-toggle-label[_ngcontent-%COMP%]{margin-right:4px;font-size:14px}"]})}return o})();function ve(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",8),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw(4);return t.KtG(l.addDataSource(a))}),t.TgZ(1,"mat-icon"),t._uU(2),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA()()}if(2&o){const e=s.$implicit,i=t.oxw(4);t.Q6J("tippy",e.UiHint||e.Name),t.xp6(2),t.Oqu(e.Icon||i.guiTypes.Unknown.Icon),t.xp6(2),t.Oqu(e.Name)}}function Ce(o,s){if(1&o&&(t.TgZ(0,"div",7),t.SjG(1,ve,5,3,"div",9,t.QCX().trackDataSources),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.wJu(e.value)}}function xe(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",5),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw(2);return t.KtG(l.toggleItem(a.key))}),t.TgZ(1,"mat-icon"),t._uU(2),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA()(),t.YNc(5,Ce,3,0,"div",6)}if(2&o){const e=s.$implicit,i=t.oxw(2);let n;t.Q6J("tippy",i.guiTypes[e.key].UiHint||e.key),t.xp6(2),t.Oqu(i.guiTypes[e.key].Icon||i.guiTypes.Unknown.Icon),t.xp6(2),t.Oqu(null!==(n=null!==(n=i.guiTypes[e.key].Label)&&void 0!==n?n:i.guiTypes[e.key].Name)&&void 0!==n?n:e.key),t.xp6(1),t.um2(5,i.toggledItems.includes(e.key)?5:-1)}}function Se(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"span",3),t._uU(3,"Show Advanced"),t.qZA(),t.TgZ(4,"mat-slide-toggle",4),t.NdJ("change",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleDifficulty(n))}),t.qZA()(),t.SjG(5,xe,6,4,null,null,t.QCX().trackGroups),t.ALo(7,"keyvalue"),t.qZA()}2&o&&(t.xp6(5),t.wJu(t.lcZ(7,0,s.sorted)))}let be=(()=>{class o{constructor(e){this.visualQueryService=e,this.toggledItems=[],this.guiTypes=I,this.difficulties=m.Zy.pipelineDesigner.dataSourceDifficulties,this.difficulty$=new M.X(this.difficulties.default)}ngOnInit(){this.viewModel$=(0,k.a)([(0,k.a)([this.visualQueryService.dataSources$,this.difficulty$]).pipe((0,y.U)(([e,i])=>function ye(o,s){if(!o)return;const i=(0,C.Z)(o).filter(a=>a.Difficulty<=s&&a.PartAssemblyAndType!==m.Zy.pipelineDesigner.outDataSource.PartAssemblyAndType);i.sort((a,l)=>a.Name.toLocaleLowerCase().localeCompare(l.Name.toLocaleLowerCase()));const n={};for(const a of i){const l=a.PrimaryType;n[l]?n[l].push(a):n[l]=[a]}return n}(e,i)))]).pipe((0,y.U)(([e])=>({sorted:e})))}ngOnDestroy(){this.difficulty$.complete()}toggleDifficulty(e){this.difficulty$.next(e.checked?this.difficulties.advanced:this.difficulties.default)}addDataSource(e){this.visualQueryService.addDataSource(e)}toggleItem(e){O.iX.toggleInArray(e,this.toggledItems)}trackGroups(e,i){return i.key}trackDataSources(e,i){return i.PartAssemblyAndType}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(D))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-add-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"eav-show-advanced"],[1,"eav-slide-toggle-label"],["color","primary",3,"change"],["tippyShowDelay","750",1,"collapsible",3,"tippy","click"],["class","list"],[1,"list"],["tippyShowDelay","750",1,"list-item",3,"tippy","click"],["class","list-item","tippyShowDelay","750",3,"tippy"]],template:function(i,n){if(1&i&&(t.YNc(0,Se,8,2,"div",0),t.ALo(1,"async")),2&i){let a;t.um2(0,(a=t.lcZ(1,1,n.viewModel$))?0:-1,a)}},dependencies:[E.$,S.Hw,w.Rr,g.Ov,g.Nd],styles:[".mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin:6px;-webkit-user-select:none;user-select:none}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:8px;margin-right:4px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-user-select:none;user-select:none}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px;margin-left:6px;margin-right:4px}.eav-show-advanced[_ngcontent-%COMP%]{margin-left:8px}"]})}return o})();const z=o=>({active:o}),Te=[{path:"",component:(()=>{class o{constructor(e,i,n){this.context=e,this.route=i,this.visualQueryService=n,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}ngOnInit(){this.visualQueryService.init()}toggleExplorer(e){this.activeExplorer=this.activeExplorer===e?null:e}openHelp(){window.open("https://go.2sxc.org/visual-query","_blank")}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(R._),t.Y36(b.gz),t.Y36(D))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-visual-query"]],viewQuery:function(i,n){if(1&i&&t.Gf(B,5),2&i){let a;t.iGM(a=t.CRH())&&(n.plumbEditor=a.first)}},features:[t._Bn([D])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["tippy","Run",1,"button",3,"ngClass","click"],["tippy","Add",1,"button",3,"ngClass","click"],[1,"spacer"],["tippy","Help",1,"button",3,"click"],[3,"hidden"]],template:function(i,n){1&i&&(t._UZ(0,"router-outlet"),t.TgZ(1,"div",0)(2,"div",1)(3,"div",2),t.NdJ("click",function(){return n.toggleExplorer(n.explorer.run)}),t.TgZ(4,"mat-icon"),t._uU(5,"play_arrow"),t.qZA()(),t.TgZ(6,"div",3),t.NdJ("click",function(){return n.toggleExplorer(n.explorer.add)}),t.TgZ(7,"mat-icon"),t._uU(8,"add"),t.qZA()(),t._UZ(9,"div",4),t.TgZ(10,"div",5),t.NdJ("click",function(){return n.openHelp()}),t.TgZ(11,"mat-icon"),t._uU(12,"help_outline"),t.qZA()()(),t._UZ(13,"app-run-explorer",6)(14,"app-add-explorer",6)(15,"app-plumb-editor"),t.qZA()),2&i&&(t.xp6(3),t.Q6J("ngClass",t.VKq(4,z,n.activeExplorer===n.explorer.run)),t.xp6(3),t.Q6J("ngClass",t.VKq(6,z,n.activeExplorer===n.explorer.add)),t.xp6(7),t.Q6J("hidden",n.activeExplorer!==n.explorer.run),t.xp6(1),t.Q6J("hidden",n.activeExplorer!==n.explorer.add))},dependencies:[g.mk,E.$,b.lC,S.Hw,_e,be,B],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})}return o})(),children:[J.ii.route,{matcher:it.eP,loadChildren:()=>Promise.all([r.e("default-projects_eav-ui_src_app_create-file-dialog_index_ts"),r.e("default-node_modules_angular_material_fesm2022_list_mjs"),r.e("default-node_modules_angular_material_fesm2022_autocomplete_mjs"),r.e("default-node_modules_angular_material_fesm2022_card_mjs"),r.e("default-projects_eav-ui_src_app_edit_edit_module_ts"),r.e("default-node_modules_angular_cdk_fesm2022_drag-drop_mjs"),r.e("default-node_modules_angular_material_fesm2022_menu_mjs"),r.e("projects_eav-ui_src_app_features_features_module_ts-node_modules_angular_material_fesm2022_ba-6782aa")]).then(r.bind(r,152)).then(o=>o.EditModule),data:{history:!1}}]}];let De=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({imports:[b.Bz.forChild(Te),b.Bz]})}return o})(),Ze=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({providers:[R._,$,H.D,L.s,{provide:A.o2,useValue:{subscriptSizing:"dynamic"}},{provide:N.PG,useValue:{hideSingleSelectionIndicator:!0}},{provide:w.HT,useValue:{hideIcon:!0}}],imports:[g.ez,X.q,De,S.Ps,v.ot,w.rP,F.ZX,_.Is,U.Nh,A.lN,h.UX,N.LD,G.c]})}return o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/17.01.02/dist/ng-edit/projects_eav-ui_src_app_visual-query_visual-query_module_ts.ca32fbb8e9c54d43.js.map